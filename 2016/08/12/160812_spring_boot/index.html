<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Benny" />



<meta name="description" content="Spring Boot">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot">
<meta property="og:url" content="/2016/08/12/160812_spring_boot/index.html">
<meta property="og:site_name" content="Benny">
<meta property="og:description" content="Spring Boot">
<meta property="og:image" content="http://ww3.sinaimg.cn/large/610dc034jw1f48mxqcvkvj20lt0pyaed.jpg">
<meta property="og:updated_time" content="2016-09-28T06:27:08.421Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Boot">
<meta name="twitter:description" content="Spring Boot">
<meta name="twitter:image" content="http://ww3.sinaimg.cn/large/610dc034jw1f48mxqcvkvj20lt0pyaed.jpg">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Benny" type="application/atom+xml">



    <link rel="shortcut icon" href="http://file.ipadown.com/uploads/mjh/r3cqsmmw1pa.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Spring Boot | Benny</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?cefc2b6ee3fc7b9bc86d0adb0741f5d7";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="http://file.ipadown.com/uploads/mjh/r3cqsmmw1pa.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Benny</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Coding is my life</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:xiaoc1314@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/YAML/">YAML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javaweb/">javaweb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/">lambda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plantUML/">plantUML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码整洁/">代码整洁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单例模式/">单例模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具类，类库/">工具类，类库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/框架/">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模板/">模板</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/测试/">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程/">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程工具/">编程工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/配置文件/">配置文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/集合/">集合</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高效的java/">高效的java</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">Coding is my life</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Benny</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="http://file.ipadown.com/uploads/mjh/r3cqsmmw1pa.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Benny</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Coding is my life</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:xiaoc1314@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-160812_spring_boot" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/160812_spring_boot/" class="article-date">
      <time datetime="2016-08-12T06:50:27.000Z" itemprop="datePublished">2016-08-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Spring Boot
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Spring-boot/">Spring boot</a><a class="article-category-link" href="/categories/Spring-boot/Spring/">Spring</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/框架/">框架</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h2><p><img src="http://ww3.sinaimg.cn/large/610dc034jw1f48mxqcvkvj20lt0pyaed.jpg" alt="0526"></p>
<a id="more"></a>
<h2 id="第一个项目"><a href="#第一个项目" class="headerlink" title="第一个项目"></a>第一个项目</h2><ul>
<li>选择spring intelizer 之后</li>
<li>选择构建方式要选择Gradle 默认是Maven</li>
<li>最后要选择本地的gradle 不然会一直去远程下载网速慢的话就卡死了</li>
</ul>
<h2 id="项目构建"><a href="#项目构建" class="headerlink" title="项目构建"></a>项目构建</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">repositories &#123; jcenter() &#125;</div><div class="line">dependencies &#123;</div><div class="line">classpath(<span class="string">"org.springframework.boot:spring-boot-gradle-plugin:1.3.0.BUILD-SNAPSHOT"</span>)</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">apply plugin: <span class="string">'java'</span></div><div class="line">apply plugin: <span class="string">'spring-boot'</span></div><div class="line">repositories &#123; jcenter() &#125;</div><div class="line">dependencies &#123;</div><div class="line">compile(<span class="string">"org.springframework.boot:spring-boot-starter-web"</span>)</div><div class="line">testCompile(<span class="string">"org.springframework.boot:spring-boot-starter-test"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">com</div><div class="line">+- example</div><div class="line">+- myproject</div><div class="line">+- Application.java</div><div class="line">|</div><div class="line">+- domain</div><div class="line">| +- Customer.java</div><div class="line">| +- CustomerRepository.java</div><div class="line">|</div><div class="line">+- service</div><div class="line">| +- CustomerService.java</div><div class="line">|</div><div class="line">+- web</div><div class="line">+- CustomerController.java</div></pre></td></tr></table></figure>
<h2 id="Spring-Boot属性配置文件详解"><a href="#Spring-Boot属性配置文件详解" class="headerlink" title="Spring Boot属性配置文件详解"></a>Spring Boot属性配置文件详解</h2><h3 id="自定义属性与加载"><a href="#自定义属性与加载" class="headerlink" title="自定义属性与加载"></a>自定义属性与加载</h3><ul>
<li>我们在使用Spring Boot的时候，通常也需要定义一些自己使用的属性，我们可以如下方式直接定义：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">com.OKjava.blog.name=benny</div><div class="line">com.OKjava.blog.title=Spring Boot学习笔记</div></pre></td></tr></table></figure>
<ul>
<li>然后通过<code>@Value(&quot;${属性名}&quot;)</code>注解来加载对应的配置属性，具体如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogProperties</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;com.didispace.blog.name&#125;"</span>)</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;com.didispace.blog.title&#125;"</span>)</div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line">    <span class="comment">// 省略getter和setter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>通过单元测试来验证BlogProperties中的属性是否已经根据配置文件加载了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@SpringApplicationConfiguration</span>(Application.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationTests</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> BlogProperties blogProperties;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getHello</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        Assert.assertEquals(blogProperties.getName(), <span class="string">"程序猿DD"</span>);</div><div class="line">        Assert.assertEquals(blogProperties.getTitle(), <span class="string">"Spring Boot教程"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参数间的引用"><a href="#参数间的引用" class="headerlink" title="参数间的引用"></a>参数间的引用</h3><ul>
<li>在<code>application.properties</code>中的各个参数之间也可以直接引用来使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">com.OKjava.blog.name=benny</div><div class="line">com.OKjava.blog.title=Spring Boot学习笔记</div><div class="line">com.OKjava.blog.desc=$&#123;com.OKjava.blog.name&#125;正在努力写《$&#123;com.OKjava.blog.title&#125;》</div></pre></td></tr></table></figure>
<h3 id="使用随机数"><a href="#使用随机数" class="headerlink" title="使用随机数"></a>使用随机数</h3><ul>
<li>在一些情况下，有些参数我们需要希望它不是一个固定的值，比如密钥、服务端口等。Spring Boot的属性配置文件中可以通过${random}来产生int值、long值或者string字符串，来支持属性的随机值。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 随机字符串</div><div class="line">com.OKjava.blog.value=$&#123;random.value&#125;  </div><div class="line"># 随机int</div><div class="line">com.OKjava.blog.number=$&#123;random.int&#125;  </div><div class="line"># 随机long</div><div class="line">com.OKjava.blog.bignumber=$&#123;random.long&#125;  </div><div class="line"># 10以内的随机数</div><div class="line">com.OKjava.blog.test1=$&#123;random.int(10)&#125;  </div><div class="line"># 10-20的随机数</div><div class="line">com.OKjava.blog.test2=$&#123;random.int[10,20]&#125;</div></pre></td></tr></table></figure>
<h3 id="通过命令行设置属性值"><a href="#通过命令行设置属性值" class="headerlink" title="通过命令行设置属性值"></a>通过命令行设置属性值</h3><ul>
<li><p>相信使用过一段时间Spring Boot的用户，一定知道这条命令：<code>java -jar xxx.jar --server.port=8888</code>，通过使用<code>--server.port</code>属性来设置xxx.jar应用的端口为8888。</p>
</li>
<li><p>在命令行运行时，连续的两个减号<code>--</code>就是对<strong> application.properties </strong>中的属性值进行赋值的标识。所以，<code>java -jar xxx.jar --server.port=8888</code>命令，等价于我们在<strong> application.properties </strong>中添加属性<strong> server.port=8888 </strong>，该设置在样例工程中可见，读者可通过删除该值或使用命令行来设置该值来验证。</p>
</li>
<li><p>通过命令行来修改属性值固然提供了不错的便利性，但是通过命令行就能更改应用运行的参数，那岂不是很不安全？是的，所以<strong> Spring Boot </strong>提供了屏蔽命令行访问属性的设置</p>
</li>
<li><strong> Spring Boot </strong>屏蔽命令行访问属性的设置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SpringApplication.setAddCommandLineProperties(<span class="keyword">false</span>)。</div></pre></td></tr></table></figure>
<h3 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h3><p>我们在开发Spring Boot应用时，通常同一套程序会被应用和安装到几个不同的环境，比如：开发、测试、生产等。其中每个环境的数据库地址、服务器端口等等配置都会不同，如果在为不同环境打包时都要频繁修改配置文件的话，那必将是个非常繁琐且容易发生错误的事。</p>
<p>在Spring Boot中多环境配置文件名需要满足<strong> application -  {profile}.properties </strong>的格式，其中<code>{profile}</code>对应你的环境标识，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">application-dev.properties：开发环境</div><div class="line">application-test.properties：测试环境</div><div class="line">application-prod.properties：生产环境</div></pre></td></tr></table></figure>
<ul>
<li><p>至于哪个具体的配置文件会被加载，需要在application.properties文件中通过spring.profiles.active属性来设置，其值对应{profile}值。</p>
</li>
<li><p>如：spring.profiles.active=test就会加载application-test.properties配置文件内容</p>
</li>
<li><p>针对各环境新建不同的配置文件<strong> application-dev.properties </strong>、<strong>application-test.properties </strong>、<strong> application-prod.properties</strong></p>
</li>
<li><p>在这三个文件均都设置不同的server.port属性，如：dev环境设置为1111，test环境设置为2222，prod环境设置为3333</p>
</li>
<li><p><strong> application.properties </strong>中设置<code>spring.profiles.active=dev</code>，就是说默认以dev环境设置</p>
</li>
<li><p>测试不同配置的加载</p>
</li>
<li><p>执行java -jar xxx.jar，可以观察到服务端口被设置为1111，也就是默认的开发环境（dev）</p>
</li>
<li><p>执行java -jar xxx.jar –spring.profiles.active=test，可以观察到服务端口被设置为2222，也就是测试环境的配置（test）</p>
</li>
<li><p>执行java -jar xxx.jar –spring.profiles.active=prod，可以观察到服务端口被设置为3333，也就是生产环境的配置（prod）</p>
</li>
</ul>
<p>按照上面的实验，可以如下总结多环境的配置思路：</p>
<blockquote>
<p><strong> application.properties </strong>中配置通用内容，并设<code>spring.profiles.active=dev</code>，以开发环境为默认配置<br><strong> application-{profile}.properties </strong>中配置各个环境不同的内容通过命令行方式去激活不同环境的配置</p>
</blockquote>
<h2 id="Spring-boot-应用的入口"><a href="#Spring-boot-应用的入口" class="headerlink" title="Spring boot 应用的入口"></a>Spring boot 应用的入口</h2><ul>
<li><code>Application.java</code><ul>
<li><code>Application.java</code>文件将声明<code>main</code> 方法，还有基本的 <code>@Configuration</code>  。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableAutoConfiguration</span></div><div class="line"><span class="meta">@ComponentScan</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SpringApplication.run(Application.class, args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="构建web项目应用模板"><a href="#构建web项目应用模板" class="headerlink" title="构建web项目应用模板"></a>构建web项目应用模板</h2><blockquote>
<p>提别注意：</p>
</blockquote>
<ul>
<li><p><strong>@RestController</strong> 和 <strong>@Controller</strong> 的区别</p>
<ul>
<li>页面渲染时，使用 <strong>@Controller</strong></li>
<li>Json数据交互时，使用 <strong>@RestController</strong></li>
</ul>
</li>
<li><p>Thymeleaf [<code>taɪm&#39;liːf</code>] 模板配置：<code>applicattion.properties</code></p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#是否开启模板缓存，默认是开启，开发时关闭</div><div class="line">spring.thymeleaf.cache=false</div><div class="line"># Check that the templates location exists.</div><div class="line">spring.thymeleaf.check-template-location=true</div><div class="line">#模板类型</div><div class="line">spring.thymeleaf.content-type=text/html</div><div class="line"># Enable MVC Thymeleaf view resolution.</div><div class="line">spring.thymeleaf.enabled=true</div><div class="line">#模板的编码设置，默认为UTF—8</div><div class="line">spring.thymeleaf.encoding=UTF-8</div><div class="line">#模板模式设置默认为HTML5</div><div class="line">spring.thymeleaf.mode=HTML5</div><div class="line"># Prefix that gets prepended to view names when building a URL.</div><div class="line">spring.thymeleaf.prefix=classpath:/templates/</div><div class="line">#模板的后缀设置</div><div class="line">spring.thymeleaf.suffix=.html</div></pre></td></tr></table></figure>
<h2 id="spring-boot-配置Tomcat"><a href="#spring-boot-配置Tomcat" class="headerlink" title="spring boot 配置Tomcat"></a>spring boot 配置Tomcat</h2><h3 id="在application-java中配置，-配置文件配置tomcat"><a href="#在application-java中配置，-配置文件配置tomcat" class="headerlink" title="在application.java中配置， 配置文件配置tomcat"></a>在application.java中配置， 配置文件配置tomcat</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">server.port= #配置程序端口，默认为8080</div><div class="line">server.session-timeout= #用户会话session过期时间，以秒为单位</div><div class="line">server.context-path= #配置访问路径</div><div class="line"></div><div class="line">server.tomcat.uri-encoding= # 配置Tomcat编码，默认为UTF-8</div><div class="line">server.tomcat.compression= # Tomcat是否开启压缩，默认为关闭</div></pre></td></tr></table></figure>
<h3 id="代码配置tomcat"><a href="#代码配置tomcat" class="headerlink" title="代码配置tomcat"></a>代码配置tomcat</h3><ul>
<li>注册一个实现<code>EmbeddedServletContainerCustomizer</code>、接口的Bean</li>
<li>若先要配置Tomcat则可以直接定义TomcatEmbeddedServletContainerFactory</li>
</ul>
<h2 id="spring-boot-整合-thymeleaf-热部署"><a href="#spring-boot-整合-thymeleaf-热部署" class="headerlink" title="spring boot 整合 thymeleaf 热部署"></a>spring boot 整合 thymeleaf 热部署</h2><ol>
<li>spring.thymeleaf.cache=<code>false</code></li>
<li>修改完代码后，<code>Ctrl + F9</code>，重新make一下</li>
</ol>
<h2 id="使用Swagger2构建强大的RESTful-API文档"><a href="#使用Swagger2构建强大的RESTful-API文档" class="headerlink" title="使用Swagger2构建强大的RESTful API文档"></a>使用Swagger2构建强大的RESTful API文档</h2><ul>
<li><code>Swagger2</code>依赖</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">compile group: <span class="string">'io.springfox'</span>, name: <span class="string">'springfox-swagger2'</span>, version: <span class="string">'2.5.0'</span></div><div class="line">compile group: <span class="string">'io.springfox'</span>, name: <span class="string">'springfox-swagger-ui'</span>, version: <span class="string">'2.5.0'</span></div></pre></td></tr></table></figure>
<ul>
<li><code>Swagger2</code>配置类<ul>
<li>在<code>Application.java</code>同级目录下创建<code>Swagger2</code>的配置类</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.ttc.myproject;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</div><div class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</div><div class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</div><div class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</div><div class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</div><div class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</div><div class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</div><div class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> by benny on 2016/8/13.</div><div class="line"> * <span class="doctag">@version</span> 1.0</div><div class="line"> * <span class="doctag">@description</span></div><div class="line"> */</div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableSwagger</span>2</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">swagger2</span> </span>&#123;</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</div><div class="line">                .apiInfo(apiInfo())</div><div class="line">                .select()</div><div class="line">                <span class="comment">//指定扫描那个包下的注解</span></div><div class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.ttc.web"</span>))</div><div class="line">                .paths(PathSelectors.any())</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</div><div class="line">                .title(<span class="string">"Spring Boot中使用Swagger2构建RESTful APIs"</span>)</div><div class="line">                .description(<span class="string">"更多Spring Boot相关文章请关注：http://www.OKjava.com/"</span>)</div><div class="line">                .termsOfServiceUrl(<span class="string">"http://www.OKjava.com/"</span>).contact(<span class="keyword">new</span> Contact(<span class="string">"benny"</span>,<span class="string">"http://www.OKjava.com/"</span>,<span class="string">""</span>))</div><div class="line">                .version(<span class="string">"1.0"</span>)</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>通过<code>@Configuration</code>注解，让<code>Spring</code>来加载该类配置。</li>
<li>再通过<code>@EnableSwagger2</code>注解来启用<code>Swagger2</code>。</li>
<li>再通过<code>createRestApi</code>函数创建<code>Docket</code>的<code>Bean</code>之后，</li>
<li><code>apiInfo()</code>用来创建该<code>Api</code>的基本信息（这些基本信息会展现在文档页面中）。</li>
<li><code>select()</code>函数返回一个<code>ApiSelectorBuilder</code>实例用来控制哪些接口暴露给<code>Swagger</code>来展现</li>
<li>本例采用指定扫描的包路径来定义，Swagger会扫描该包下所有<code>Controller</code>定义的API，并产生文档内容（除了被<code>@ApiIgnore</code>指定的请求）。</li>
</ul>
<h3 id="添加文档内容"><a href="#添加文档内容" class="headerlink" title="添加文档内容"></a>添加文档内容</h3><p>在完成了上述配置后，其实已经可以生产文档内容，但是这样的文档主要针对请求本身，而描述主要来源于函数等命名产生，对用户并不友好，我们通常需要自己增加一些说明来丰富文档内容。</p>
<ul>
<li>我们通过@ApiOperation注解来给API增加说明</li>
<li>通过@ApiImplicitParams、@ApiImplicitParam注解来给参数增加说明。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/users"</span>)     <span class="comment">// 通过这里配置使下面的映射都在/users下，可去除</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> Map&lt;Long, User&gt; users = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;Long, User&gt;());</div><div class="line"></div><div class="line">    <span class="meta">@ApiOperation</span>(value=<span class="string">"获取用户列表"</span>, notes=<span class="string">""</span>)</div><div class="line">    <span class="meta">@RequestMapping</span>(value=&#123;<span class="string">""</span>&#125;, method=RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;User&gt; r = <span class="keyword">new</span> ArrayList&lt;User&gt;(users.values());</div><div class="line">        <span class="keyword">return</span> r;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ApiOperation</span>(value=<span class="string">"创建用户"</span>, notes=<span class="string">"根据User对象创建用户"</span>)</div><div class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"user"</span>, value = <span class="string">"用户详细实体user"</span>, required = <span class="keyword">true</span>,paramType = <span class="string">"path"</span> , dataType = <span class="string">"User"</span>)</div><div class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">""</span>, method=RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">(@RequestBody User user)</span> </span>&#123;</div><div class="line">        users.put(user.getId(), user);</div><div class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###　常见swagger注解一览与使用</p>
<table>
<thead>
<tr>
<th>APIs</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Api</td>
</tr>
<tr>
<td>@ApiClass</td>
</tr>
<tr>
<td>@ApiError</td>
</tr>
<tr>
<td>@ApiErrors</td>
</tr>
<tr>
<td>@ApiOperation</td>
</tr>
<tr>
<td>@ApiParam</td>
</tr>
<tr>
<td>@ApiParamImplicit</td>
</tr>
<tr>
<td>@ApiParamsImplicit</td>
</tr>
<tr>
<td>@ApiProperty</td>
</tr>
<tr>
<td>@ApiResponse</td>
</tr>
<tr>
<td>@ApiResponses</td>
</tr>
<tr>
<td>@ApiModel</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Api</td>
<td>用在类上，说明该类的作用</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td>用在方法上，说明方法的作用</td>
</tr>
<tr>
<td>@ApiImplicitParams</td>
<td>用在方法上包含一组参数说明</td>
</tr>
<tr>
<td>@ApiImplicitParam</td>
<td>用在@ApiImplicitParams注解中，指定一个请求参数的各个方面</td>
</tr>
<tr>
<td>paramType</td>
<td>参数放在哪个地方</td>
</tr>
<tr>
<td>header</td>
<td>请求参数的获取：@RequestHeader</td>
</tr>
<tr>
<td>query</td>
<td>请求参数的获取：@RequestParam</td>
</tr>
<tr>
<td>path（用于restful接口）–&gt;</td>
<td>请求参数的获取：@PathVariable</td>
</tr>
<tr>
<td>body（不常用）</td>
</tr>
<tr>
<td>form（不常用）</td>
</tr>
<tr>
<td>name</td>
<td>参数名</td>
</tr>
<tr>
<td>dataType</td>
<td>参数类型</td>
</tr>
<tr>
<td>required</td>
<td>参数是否必须传</td>
</tr>
<tr>
<td>value</td>
<td>参数的意思</td>
</tr>
<tr>
<td>defaultValue</td>
<td>参数的默认值</td>
</tr>
<tr>
<td>@ApiResponses</td>
<td>用于表示一组响应</td>
</tr>
<tr>
<td>@ApiResponse</td>
<td>用在@ApiResponses中，一般用于表达一个错误的响应信息</td>
</tr>
<tr>
<td>code</td>
<td>数字，例如400</td>
</tr>
<tr>
<td>message</td>
<td>信息，例如”请求参数没填好”</td>
</tr>
<tr>
<td>response</td>
<td>抛出异常的类</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>描述一个Model的信息（这种一般用在post创建的时候，使用@RequestBody这样的场景，请求参数无法使用@ApiImplicitParam注解进行描述的时候）</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>描述一个model的属性</td>
</tr>
</tbody>
</table>
<blockquote>
<p>访问<code>http://localhost:8080/swagger-ui.html</code>即可看到</p>
</blockquote>
<h2 id="Spring-Boot中Web应用的统一异常处理"><a href="#Spring-Boot中Web应用的统一异常处理" class="headerlink" title="Spring Boot中Web应用的统一异常处理"></a>Spring Boot中Web应用的统一异常处理</h2><h3 id="创建全局异常处理类："><a href="#创建全局异常处理类：" class="headerlink" title="创建全局异常处理类："></a>创建全局异常处理类：</h3><ul>
<li>通过使用<code>@ControllerAdvice</code>定义统一的异常处理类,而不是在每个Controller中逐个定义。</li>
<li><code>@ExceptionHandler</code>用来定义函数针对的异常类型</li>
<li>最后将Exception对象和请求URL映射到error.html中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ControllerAdvice</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_ERROR_VIEW = <span class="string">"error"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">defaultErrorHandler</span><span class="params">(HttpServletRequest req, Exception e)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</div><div class="line">        mav.addObject(<span class="string">"exception"</span>, e);</div><div class="line">        mav.addObject(<span class="string">"url"</span>, req.getRequestURL());</div><div class="line">        mav.setViewName(DEFAULT_ERROR_VIEW);</div><div class="line">        <span class="keyword">return</span> mav;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>URL 和 URI的区别 </p>
</blockquote>
<ul>
<li>req.getRequest<code>URL</code>() <ul>
<li><code>http://localhost:8080/err</code></li>
</ul>
</li>
<li>req.getRequest<code>URI</code>() <ul>
<li><code>/err</code> </li>
</ul>
</li>
</ul>
<blockquote>
<p>实现error.html页面展示：在templates目录下创建error.html，将请求的URL和Exception对象的message输出。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line">&lt;head lang="en"&gt;  </div><div class="line">    &lt;meta charset="UTF-8" /&gt;</div><div class="line">    &lt;title&gt;统一异常处理&lt;/title&gt;</div><div class="line">&lt;/head&gt;  </div><div class="line">&lt;body&gt;  </div><div class="line">    &lt;h1&gt;Error Handler&lt;/h1&gt;</div><div class="line">    &lt;div th:text="$&#123;url&#125;"&gt;&lt;/div&gt;</div><div class="line">    &lt;div th:text="$&#123;exception.message&#125;"&gt;&lt;/div&gt;</div><div class="line">&lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>通过实现上述内容之后，我们只需要在<code>Controller</code>中抛出<code>Exception</code>，当然我们可能会有多种不同的<code>Exception</code>。然后在<code>@ControllerAdvice</code>类中，根据抛出的具体<code>Exception</code>类型匹配<code>@ExceptionHandler</code>中配置的异常类型来匹配错误映射和处理。</p>
</blockquote>
<h3 id="返回JSON格式"><a href="#返回JSON格式" class="headerlink" title="返回JSON格式"></a>返回JSON格式</h3><ul>
<li><p>本质上，只需在<code>@ExceptionHandler</code>之后加入<code>@ResponseBody</code>，就能让处理函数return的内容转换为<code>JSON</code>格式。</p>
</li>
<li><p>创建统一的JSON返回对象</p>
<ul>
<li>code：消息类型</li>
<li>message：消息内容</li>
<li>url：请求的url</li>
<li>data：请求返回的数据</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorInfo</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer OK = <span class="number">0</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer ERROR = <span class="number">100</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Integer code;</div><div class="line">    <span class="keyword">private</span> String message;</div><div class="line">    <span class="keyword">private</span> String url;</div><div class="line">    <span class="keyword">private</span> T data;</div><div class="line">    <span class="comment">// 省略getter和setter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>创建一个自定义异常，用来实验捕获该异常，并返回json</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class MyException extends Exception &#123;</div><div class="line"></div><div class="line">    public MyException(String message) &#123;</div><div class="line">        super(message);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>Controller</code>中增加json映射，抛出<code>MyException</code>异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/json"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">json</span><span class="params">()</span> <span class="keyword">throws</span> MyException </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"发生错误2"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>为MyException异常创建对应的处理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ControllerAdvice</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@ExceptionHandler</span>(value = MyException.class)</div><div class="line">    <span class="meta">@ResponseBody</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ErrorInfo&lt;String&gt; <span class="title">jsonErrorHandler</span><span class="params">(HttpServletRequest req, MyException e)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        ErrorInfo&lt;String&gt; r = <span class="keyword">new</span> ErrorInfo&lt;&gt;();</div><div class="line">        r.setMessage(e.getMessage());</div><div class="line">        r.setCode(ErrorInfo.ERROR);</div><div class="line">        r.setData(<span class="string">"Some Data"</span>);</div><div class="line">        r.setUrl(req.getRequestURL().toString());</div><div class="line">        <span class="keyword">return</span> r;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
</blockquote>
<ul>
<li>想要统一处理异常必须在Controller层出错后，<strong>手动抛出异常</strong></li>
<li>由于 <code>@ExceptionHandler(value = Exception.class)</code></li>
<li>必须<strong>抛出异常后</strong>才可以进入配置的异常处理类。</li>
</ul>
<h2 id="Spring-Boot中使用JdbcTemplate访问数据库"><a href="#Spring-Boot中使用JdbcTemplate访问数据库" class="headerlink" title="Spring Boot中使用JdbcTemplate访问数据库"></a>Spring Boot中使用JdbcTemplate访问数据库</h2><h3 id="数据源配置"><a href="#数据源配置" class="headerlink" title="数据源配置"></a>数据源配置</h3><ul>
<li>连接数据库需要引入jdbc支持</li>
<li>添加依赖<code>spring-boot-starter-jdbc</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-jdbc'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<h3 id="嵌入式数据库支持"><a href="#嵌入式数据库支持" class="headerlink" title="嵌入式数据库支持"></a>嵌入式数据库支持</h3><ul>
<li>嵌入式数据库通常用于开发和测试环境，不推荐用于生产环境。</li>
<li>Spring Boot提供自动配置，的嵌入式数据库有H2、HSQL、Derby，你不需要提供任何连接配置就能使用。</li>
<li>添加依赖置使用HSQL</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile group: <span class="string">'org.hsqldb'</span>, name: <span class="string">'hsqldb'</span>, version: <span class="string">'2.3.4'</span></div></pre></td></tr></table></figure>
<h3 id="连接生产数据源"><a href="#连接生产数据源" class="headerlink" title="连接生产数据源"></a>连接生产数据源</h3><ul>
<li>以MySQL数据库为例，先引入MySQL连接的依赖包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile group: &apos;mysql&apos;, name: &apos;mysql-connector-java&apos;, version: &apos;5.1.38&apos;</div></pre></td></tr></table></figure>
<ul>
<li>在<code>src/main/resources/application.properties</code>中配置数据源信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spring.datasource.url=jdbc:mysql:<span class="comment">//localhost:3306/test</span></div><div class="line">spring.datasource.username=dbuser</div><div class="line">spring.datasource.password=dbpass</div><div class="line">spring.datasource.driver-<span class="class"><span class="keyword">class</span>-<span class="title">name</span></span>=com.mysql.jdbc.Driver</div></pre></td></tr></table></figure>
<h3 id="使用JdbcTemplate操作数据库"><a href="#使用JdbcTemplate操作数据库" class="headerlink" title="使用JdbcTemplate操作数据库"></a>使用JdbcTemplate操作数据库</h3><ul>
<li><strong>Spring</strong>的<strong>JdbcTemplate</strong>是自动配置的，你可以直接使用<code>@Autowired</code>来注入到你自己的<code>bean</code>中来使用。</li>
</ul>
<blockquote>
<p>示例：我们在创建User表，包含属性name、age，下面来编写数据访问对象和单元测试用例。</p>
</blockquote>
<ul>
<li>定义包含有插入、删除、查询的抽象接口UserService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 新增一个用户</div><div class="line">     * <span class="doctag">@param</span> name</div><div class="line">     * <span class="doctag">@param</span> age</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(String name, Integer age)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据name删除一个用户高</div><div class="line">     * <span class="doctag">@param</span> name</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteByName</span><span class="params">(String name)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取用户总量</div><div class="line">     */</div><div class="line">    <span class="function">Integer <span class="title">getAllUsers</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 删除所有用户</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAllUsers</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>通过JdbcTemplate实现UserService中定义的数据访问操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(String name, Integer age)</span> </span>&#123;</div><div class="line">        jdbcTemplate.update(<span class="string">"insert into USER(NAME, AGE) values(?, ?)"</span>, name, age);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        jdbcTemplate.update(<span class="string">"delete from USER where NAME = ?"</span>, name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAllUsers</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">"select count(1) from USER"</span>, Integer.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAllUsers</span><span class="params">()</span> </span>&#123;</div><div class="line">        jdbcTemplate.update(<span class="string">"delete from USER"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>创建对UserService的单元测试用例，通过创建、删除和查询来验证数据库操作的正确性。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@SpringApplicationConfiguration</span>(Application.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationTests</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> UserService userSerivce;</div><div class="line"></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 准备，清空user表</span></div><div class="line">        userSerivce.deleteAllUsers();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// 插入5个用户</span></div><div class="line">        userSerivce.create(<span class="string">"a"</span>, <span class="number">1</span>);</div><div class="line">        userSerivce.create(<span class="string">"b"</span>, <span class="number">2</span>);</div><div class="line">        userSerivce.create(<span class="string">"c"</span>, <span class="number">3</span>);</div><div class="line">        userSerivce.create(<span class="string">"d"</span>, <span class="number">4</span>);</div><div class="line">        userSerivce.create(<span class="string">"e"</span>, <span class="number">5</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 查数据库，应该有5个用户</span></div><div class="line">        Assert.assertEquals(<span class="number">5</span>, userSerivce.getAllUsers().intValue());</div><div class="line"></div><div class="line">        <span class="comment">// 删除两个用户</span></div><div class="line">        userSerivce.deleteByName(<span class="string">"a"</span>);</div><div class="line">        userSerivce.deleteByName(<span class="string">"e"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 查数据库，应该有5个用户</span></div><div class="line">        Assert.assertEquals(<span class="number">3</span>, userSerivce.getAllUsers().intValue());</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Spring-Boot中使用Spring-data-jpa让数据访问更简单、更优雅"><a href="#Spring-Boot中使用Spring-data-jpa让数据访问更简单、更优雅" class="headerlink" title="Spring Boot中使用Spring-data-jpa让数据访问更简单、更优雅"></a>Spring Boot中使用Spring-data-jpa让数据访问更简单、更优雅</h2><p>未完成待补充</p>
<h2 id="Spring-Boot中使用Redis数据库"><a href="#Spring-Boot中使用Redis数据库" class="headerlink" title="Spring Boot中使用Redis数据库"></a>Spring Boot中使用Redis数据库</h2><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><ul>
<li>Spring Boot提供的数据访问框架<strong> Spring Data Redis </strong>基于<code>Jedis</code>可以通过引入<code>spring-boot-starter-redis</code>来配置依赖关系。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-redis'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<h3 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h3><ul>
<li><strong> application.properties </strong>中加入<code>Redis</code>服务端的相关配置</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>spring.redis.database=0</code></td>
<td># Redis数据库索引（默认为0）</td>
</tr>
<tr>
<td><code>spring.redis.host=localhost</code></td>
<td># Redis服务器地址</td>
</tr>
<tr>
<td><code>spring.redis.port=6379</code></td>
<td># Redis服务器连接端口</td>
</tr>
<tr>
<td><code>spring.redis.password=</code></td>
<td># Redis服务器连接密码（默认为空）</td>
</tr>
<tr>
<td><code>spring.redis.pool.max-active=8</code></td>
<td># 连接池最大连接数（使用负值表示没有限制）</td>
</tr>
<tr>
<td><code>spring.redis.pool.max-wait=-1</code></td>
<td># 连接池最大阻塞等待时间（使用负值表示没有限制）</td>
</tr>
<tr>
<td><code>spring.redis.pool.max-idle=8</code></td>
<td># 连接池中的最大空闲连接</td>
</tr>
<tr>
<td><code>spring.redis.pool.min-idle=0</code></td>
<td># 连接池中的最小空闲连接</td>
</tr>
<tr>
<td><code>spring.redis.timeout=0</code></td>
<td># 连接超时时间（毫秒）</td>
</tr>
</tbody>
</table>
<blockquote>
<p>其中spring.redis.database的配置通常使用0即可，Redis在配置的时候可以设置数据库数量，默认为16，可以理解为数据库的schema</p>
</blockquote>
<p>…</p>
<h2 id="Spring-Boot整合MyBatis"><a href="#Spring-Boot整合MyBatis" class="headerlink" title="Spring Boot整合MyBatis"></a>Spring Boot整合MyBatis</h2><h3 id="整合依赖"><a href="#整合依赖" class="headerlink" title="整合依赖"></a>整合依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile group: <span class="string">'org.mybatis.spring.boot'</span>, name: <span class="string">'mybatis-spring-boot-starter'</span>, version: <span class="string">'1.1.1'</span></div></pre></td></tr></table></figure>
<ul>
<li>同之前介绍的使用jdbc和spring-data连接数据库一样，在<strong> application.properties </strong>中配置mysql的连接配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spring.datasource.url=jdbc:mysql:<span class="comment">//localhost:3306/blog</span></div><div class="line">spring.datasource.username=root</div><div class="line">spring.datasource.password=<span class="number">123456</span></div><div class="line">spring.datasource.driver-<span class="class"><span class="keyword">class</span>-<span class="title">name</span></span>=com.mysql.jdbc.Driver</div></pre></td></tr></table></figure>
<h3 id="使用MyBatis"><a href="#使用MyBatis" class="headerlink" title="使用MyBatis"></a>使用MyBatis</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">private</span> String user_name;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> role_id;</div><div class="line">    <span class="keyword">private</span> String image_path;</div><div class="line">    <span class="keyword">private</span> String encryption_salt;</div><div class="line">	<span class="comment">//省略getter和setter</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Mapper</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT * FROM USER WHERE NAME = #&#123;name&#125;"</span>)</div><div class="line">    <span class="function">User <span class="title">findByName</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name)</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Insert</span>(<span class="string">"INSERT INTO USER(NAME, AGE) VALUES(#&#123;name&#125;, #&#123;age&#125;)"</span>)</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name, @<span class="title">Param</span><span class="params">(<span class="string">"age"</span>)</span> Integer age)</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span>(classes = Application.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImplTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> UserService userService;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAllUser</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        List&lt;User&gt; allUser = userService.getAllUser();</div><div class="line">        System.out.println(allUser.size());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Spring-Boot中使用AOP统一处理Web请求日志"><a href="#Spring-Boot中使用AOP统一处理Web请求日志" class="headerlink" title="Spring Boot中使用AOP统一处理Web请求日志"></a>Spring Boot中使用AOP统一处理Web请求日志</h2><h3 id="引入依赖-1"><a href="#引入依赖-1" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-aop'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<ul>
<li><p>在完成了引入AOP依赖包后，一般来说并不需要去做其他配置。也许在Spring中使用过注解配置方式的人会问是否需要在程序主类中增加@EnableAspectJAutoProxy来启用，实际并不需要。</p>
</li>
<li><p>可以看下面关于AOP的默认配置属性，其中<strong> spring.aop.auto </strong>属性默认是开启的，也就是说只要引入了AOP依赖后，默认已经增加了<code>@EnableAspectJAutoProxy</code></p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># AOP</div><div class="line">spring.aop.auto=true # Add @EnableAspectJAutoProxy.</div><div class="line">spring.aop.proxy-target-class=false # Whether subclass-based (CGLIB) proxies are to be created (true) as</div><div class="line"> opposed to standard Java interface-based proxies (false).</div></pre></td></tr></table></figure>
<blockquote>
<p>而当我们需要使用CGLIB来实现AOP的时候，需要配置<code>spring.aop.proxy-target-class=true</code>，不然默认使用的是标准Java的实现。</p>
</blockquote>
<h3 id="实现Web层的日志切面"><a href="#实现Web层的日志切面" class="headerlink" title="实现Web层的日志切面"></a>实现Web层的日志切面</h3><p>实现AOP的切面主要有以下几个要素：</p>
<ul>
<li>使用<code>@Aspect</code>注解将一个java类定义为切面类</li>
<li>使用<code>@Pointcut</code>定义一个切入点，可以是一个规则表达式，比如下例中某个package下的所有函数，也可以是一个注解等。</li>
<li>根据需要在切入点不同位置的切入内容<ul>
<li>使用<code>@Before</code>在切入点开始处切入内容</li>
<li>使用<code>@After</code>在切入点结尾处切入内容</li>
<li>使用<code>@AfterReturning</code>在切入点return内容之后切入内容（可以用来对处理返回值做一些加工处理）</li>
<li>使用<code>@Around</code>在切入点前后切入内容，并自己控制何时执行切入点自身的内容</li>
<li>使用<code>@AfterThrowing</code>用来处理当切入内容部分抛出异常之后的处理逻辑</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogAspect</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Logger logger = Logger.getLogger(getClass());</div><div class="line"></div><div class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public * com.OKjava.web..*.*(..))"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webLog</span><span class="params">()</span></span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="meta">@Before</span>(<span class="string">"webLog()"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        <span class="comment">// 接收到请求，记录请求内容</span></div><div class="line">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</div><div class="line">        HttpServletRequest request = attributes.getRequest();</div><div class="line"></div><div class="line">        <span class="comment">// 记录下请求内容</span></div><div class="line">        logger.info(<span class="string">"URL : "</span> + request.getRequestURL().toString());</div><div class="line">        logger.info(<span class="string">"HTTP_METHOD : "</span> + request.getMethod());</div><div class="line">        logger.info(<span class="string">"IP : "</span> + request.getRemoteAddr());</div><div class="line">        logger.info(<span class="string">"CLASS_METHOD : "</span> + joinPoint.getSignature().getDeclaringTypeName() + <span class="string">"."</span> + joinPoint.getSignature().getName());</div><div class="line">        logger.info(<span class="string">"ARGS : "</span> + Arrays.toString(joinPoint.getArgs()));</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@AfterReturning</span>(returning = <span class="string">"ret"</span>, pointcut = <span class="string">"webLog()"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(Object ret)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        <span class="comment">// 处理完请求，返回内容</span></div><div class="line">        logger.info(<span class="string">"RESPONSE : "</span> + ret);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>可以看上面的例子，通过<code>@Pointcut</code>定义的切入点为com.OKjava.web包下的所有函数（对web层所有请求处理做切入点），然后通过<code>@Before</code>实现，对请求内容的日志记录（本文只是说明过程，可以根据需要调整内容），最后通过<code>@AfterReturning</code>记录请求返回的对象。</p>
</li>
<li><p>通过运行程序并访问：<a href="http://localhost:8080/hello?name=benny，可以获得下面的日志输出" target="_blank" rel="external">http://localhost:8080/hello?name=benny，可以获得下面的日志输出</a></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">19</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">13</span>,<span class="number">156</span>  INFO WebLogAspect:<span class="number">41</span> - URL : http:<span class="comment">//localhost:8080/hello  </span></div><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">19</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">13</span>,<span class="number">156</span>  INFO WebLogAspect:<span class="number">42</span> - HTTP_METHOD : http:<span class="comment">//localhost:8080/hello  </span></div><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">19</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">13</span>,<span class="number">157</span>  INFO WebLogAspect:<span class="number">43</span> - IP : <span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">1</span>  </div><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">19</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">13</span>,<span class="number">160</span>  INFO WebLogAspect:<span class="number">44</span> - CLASS_METHOD : com.didispace.web.HelloController.hello  </div><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">19</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">13</span>,<span class="number">160</span>  INFO WebLogAspect:<span class="number">45</span> - ARGS : [didi]  </div><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">19</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">13</span>,<span class="number">170</span>  INFO WebLogAspect:<span class="number">52</span> - RESPONSE:Hello didi</div></pre></td></tr></table></figure>
<h3 id="优化：AOP切面中的同步问题"><a href="#优化：AOP切面中的同步问题" class="headerlink" title="优化：AOP切面中的同步问题"></a>优化：AOP切面中的同步问题</h3><ul>
<li><p>WebLogAspect切面中，分别通过doBefore和doAfterReturning两个独立函数实现了切点头部和切点返回后执行的内容，若我们想统计请求的处理时间，就需要在doBefore处记录时间，并在doAfterReturning处通过当前时间与开始处记录的时间计算得到请求处理的消耗时间。</p>
</li>
<li><p>那么我们是否可以在WebLogAspect切面中定义一个成员变量来给doBefore和doAfterReturning一起访问呢？是否会有同步问题呢？</p>
</li>
<li><p>的确，直接在这里定义基本类型会有同步问题，所以我们可以引入ThreadLocal对象，像下面这样进行记录：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogAspect</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Logger logger = Logger.getLogger(getClass());</div><div class="line"></div><div class="line">    ThreadLocal&lt;Long&gt; startTime = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public * com.didispace.web..*.*(..))"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webLog</span><span class="params">()</span></span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="meta">@Before</span>(<span class="string">"webLog()"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        startTime.set(System.currentTimeMillis());</div><div class="line"></div><div class="line">        <span class="comment">// 省略日志记录内容</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@AfterReturning</span>(returning = <span class="string">"ret"</span>, pointcut = <span class="string">"webLog()"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(Object ret)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        <span class="comment">// 处理完请求，返回内容</span></div><div class="line">        logger.info(<span class="string">"RESPONSE : "</span> + ret);</div><div class="line">        logger.info(<span class="string">"SPEND TIME : "</span> + (System.currentTimeMillis() - startTime.get()));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="优化：AOP切面的优先级"><a href="#优化：AOP切面的优先级" class="headerlink" title="优化：AOP切面的优先级"></a>优化：AOP切面的优先级</h3><ul>
<li><p>由于通过AOP实现，程序得到了很好的解耦，但是也会带来一些问题，比如：我们可能会对Web层做多个切面，校验用户，校验头信息等等，这个时候经常会碰到切面的处理顺序问题。</p>
</li>
<li><p>所以，我们需要定义每个切面的优先级，我们需要<code>@Order(i)</code>注解来标识切面的优先级。i的值越小，优先级越高。假设我们还有一个切面是CheckNameAspect用来校验name必须为didi，我们为其设置<code>@Order(10)</code>，而上文中WebLogAspect设置为<code>@Order(5)</code>，所以WebLogAspect有更高的优先级，这个时候执行顺序是这样的：</p>
</li>
<li><p>在<code>@Before</code>中优先执行@Order(5)的内容，再执行<code>@Order(10)</code>的内容</p>
</li>
<li>在<code>@After</code>和@<code>AfterReturning</code>中优先执行<code>@Order(10)</code>的内容，再执行@Order(5)的内容</li>
<li>所以我们可以这样子总结：</li>
</ul>
<blockquote>
<p>在切入点前的操作，按order的值由小到大执行<br>在切入点后的操作，按order的值由大到小执行</p>
</blockquote>
<h2 id="SpringApplication"><a href="#SpringApplication" class="headerlink" title="SpringApplication"></a>SpringApplication</h2><h3 id="自定义Banner"><a href="#自定义Banner" class="headerlink" title="自定义Banner"></a>自定义Banner</h3><ul>
<li><p>通过在classpath下添加一个banner.txt或设置banner.location来指定相应的文件可以改变启动过程中打印的banner。如果这个文件有特殊的编码，你可以使用banner.encoding设置它（默认为UTF-8）。</p>
</li>
<li><p>在banner.txt中可以使用如下的变量：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>${application.version}</td>
<td>MANIFEST.MF中声明的应用版本号，例如1.0</td>
</tr>
<tr>
<td>${application.formatted-version</td>
<td>MANIFEST.MF中声明的被格式化后的应用版本号（被括号包裹且以v作为前缀），用于显示，例如(v1.0)</td>
</tr>
<tr>
<td>${spring-boot.version}</td>
<td>正在使用的SpringBoot版本号，例如1.2.2.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>${spring-boot.formatted-version}</td>
<td>正在使用的SpringBoot被格式化后的版本号（被括号包裹且以v作为前缀）, 用于显示，例如(v1.2.2.BUILD-SNAPSHOT)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注：如果想以编程的方式产生一个<strong>banner</strong>，可以使用<code>SpringBootApplication.setBanner(…)</code>方法。<br>使用<code>org.springframework.boot.Banner</code>接口，实现你自己的<code>printBanner()</code>方法。</p>
</blockquote>
<h3 id="自定义SpringApplicatio"><a href="#自定义SpringApplicatio" class="headerlink" title="自定义SpringApplicatio"></a>自定义SpringApplicatio</h3><ul>
<li>如果默认的SpringApplication不符合你的口味，你可以创建一个本地的实例并自定义它。例<br>如，关闭banner你可以这样写：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">SpringApplication app = <span class="keyword">new</span> SpringApplication(MySpringConfiguration.class);</div><div class="line">app.setShowBanner(<span class="keyword">false</span>);</div><div class="line">app.run(args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注：传递给<strong>SpringApplication</strong>的构造器参数是springbeans的配置源。在大多数情况下，这些将是<code>@Configuration</code>类的引用，但它们也可能是XML配置或要扫描包的引用</p>
<p>你也可以使用<strong>application.properties</strong>文件来配置<strong>SpringApplication</strong></p>
</blockquote>
<h3 id="流畅的构建API"><a href="#流畅的构建API" class="headerlink" title="流畅的构建API"></a>流畅的构建API</h3><ul>
<li>如果你需要创建一个分层的ApplicationContext（多个具有父子关系的上下文），或你只是喜欢使用流畅的构建API，你可以使用SpringApplicationBuilder。</li>
<li>SpringApplicationBuilder允许你以链式方式调用多个方法，包括可以创建层次结构的parent和child方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> SpringApplicationBuilder()</div><div class="line">.showBanner(<span class="keyword">false</span>)</div><div class="line">.sources(Parent.class)</div><div class="line">.child(Application.class)</div><div class="line">.run(args);</div></pre></td></tr></table></figure>
<blockquote>
<p>注：创建ApplicationContext层次时有些限制，比如，Web组件(components)必须包含在子上下文(child context)中，且相同的Environment即用于父上下文也用于子上下文中。</p>
</blockquote>
<h3 id="Application事件和监听器"><a href="#Application事件和监听器" class="headerlink" title="Application事件和监听器"></a>Application事件和监听器</h3><ul>
<li><p>除了常见的Spring框架事件，比如<strong>ContextRefreshedEvent</strong>，一个<strong>SpringApplication</strong>也发送一<br>些额外的应用事件。一些事件实际上是在ApplicationContext被创建前触发的。</p>
</li>
<li><p>你可以使用多种方式注册事件监听器，最普通的是使用<code>SpringApplication.addListeners(…)</code>方<br>法。在你的应用运行时，应用事件会以下面的次序发送：</p>
</li>
</ul>
<ol>
<li>在运行开始，但除了监听器注册和初始化以外的任何处理之前，会发送一个<strong>ApplicationStartedEvent</strong></li>
<li>在Environment将被用于已知的上下文，但在上下文被创建前，会发送一个<strong>ApplicationEnvironmentPreparedEvent</strong></li>
<li>在refresh开始前，但在bean定义已被加载后，会发送一个<strong>ApplicationPreparedEvent</strong>。</li>
<li>启动过程中如果出现异常，会发送一个<strong>ApplicationFailedEvent</strong>。</li>
</ol>
<blockquote>
<p>注：你通常不需要使用应用程序事件，但知道它们的存在会很方便（在某些场合可能会使用到）。<br>在Spring内部，Spring Boot使用事件处理各种各样的任务。</p>
</blockquote>
<h3 id="Web环境"><a href="#Web环境" class="headerlink" title="Web环境"></a>Web环境</h3><ul>
<li><p>一个SpringApplication将尝试为你创建正确类型的ApplicationContext。</p>
</li>
<li><p>在默认情况下，使用AnnotationConfigApplicationContext或AnnotationConfigEmbeddedWebApplicationContext取决于你正在开发的是否是web应用。</p>
</li>
<li><p>用于确定一个web环境的算法相当简单（基于是否存在某些类）。如果需要覆盖默认行为，你可以使用setWebEnvironment(boolean webEnvironment)。</p>
</li>
<li><p>通过调用setApplicationContextClass(…)，你可以完全控制ApplicationContext的类型。</p>
</li>
</ul>
<blockquote>
<p>注：当JUnit测试里使用SpringApplication时，调用setWebEnvironment(false)是可取的。</p>
</blockquote>
<h3 id="命令行启动器"><a href="#命令行启动器" class="headerlink" title="命令行启动器"></a>命令行启动器</h3><ul>
<li>如果你想获取原始的命令行参数，或一旦SpringApplication启动，你需要运行一些特定的代<br>码，你可以实现CommandLineRunner接口。在所有实现该接口的Spring beans上将调用<br>run(String… args)方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.boot.*</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.*</div><div class="line"></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</div><div class="line"><span class="comment">// Do something...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果一些<strong>CommandLineRunner beans</strong>被定义必须以特定的次序调用，你可以额外实现<br><code>org.springframework.core.Ordered</code>接口或使用<code>org.springframework.core.annotation.Order</code>注<br>解</li>
</ul>
<h3 id="Application退出"><a href="#Application退出" class="headerlink" title="Application退出"></a>Application退出</h3><ul>
<li><p>每个<strong>SpringApplication</strong>在退出时为了确保<strong>ApplicationContext</strong>被优雅的关闭，将会注册一个<code>JVM</code>的<strong>shutdown</strong>钩子。</p>
</li>
<li><p>所有标准的Spring生命周期回调（比如，DisposableBean接口或@PreDestroy注解）都能使用。</p>
</li>
<li><p>如果beans想在应用结束时返回一个特定的退出码（exitcode），可以实现<code>org.springframework.boot.ExitCodeGenerator</code>接口。</p>
</li>
</ul>
<h2 id="外化配置"><a href="#外化配置" class="headerlink" title="外化配置"></a>外化配置</h2><ul>
<li>Spring Boot允许外化（externalize）你的配置，这样你能够在不同的环境下使用相同的代码。</li>
<li>你可以使用<strong>properties</strong>文件，YAML文件，环境变量和命令行参数来外化配置。</li>
<li><p>使用<code>@Value</code>注解，可以直接将属性值注入到你的beans中，并通过Spring的Environment抽象或绑定到结构化对象来访问。</p>
</li>
<li><p>Spring Boot使用一个非常特别的PropertySource次序来允许对值进行合理的覆盖，需要以下<br>面的次序考虑属性：</p>
</li>
</ul>
<ol>
<li>命令行参数</li>
<li>来自于java:comp/env的JNDI属性</li>
<li>Java系统属性（System.getProperties()）</li>
<li>操作系统环境变量</li>
<li>只有在random.*里包含的属性会产生一个RandomValuePropertySource</li>
<li>在打包的jar外的应用程序配置文件（application.properties，包含YAML和profile变量）</li>
<li>在打包的jar内的应用程序配置文件（application.properties，包含YAML和profile变量）</li>
<li>在@Configuration类上的@PropertySource注解</li>
<li>默认属性（使用SpringApplication.setDefaultProperties指定）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.stereotype.*</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</div><div class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;name&#125;"</span>)</div><div class="line"><span class="keyword">private</span> String name;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>你可以将一个application.properties文件捆绑到jar内，用来提供一个合理的默认name属性值。</p>
</li>
<li><p>当运行在生产环境时，可以在jar外提供一个application.properties文件来覆盖name属性。</p>
</li>
<li><p>对于一次性的测试，你可以使用特定的命令行开关启动（比如，java -jar app.jar–name=”Spring”）。</p>
</li>
</ul>
<h3 id="配置随机值"><a href="#配置随机值" class="headerlink" title="配置随机值"></a>配置随机值</h3><ul>
<li><strong>RandomValuePropertySource</strong>在注入随机值（比如，密钥或测试用例）时很有用。它能产生<br>整数，longs或字符串，</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">my.secret=$&#123;random.value&#125;</div><div class="line">my.number=$&#123;random.<span class="keyword">int</span>&#125;</div><div class="line">my.bignumber=$&#123;random.<span class="keyword">long</span>&#125;</div><div class="line">my.number.less.than.ten=$&#123;random.<span class="keyword">int</span>(<span class="number">10</span>)&#125;</div><div class="line">my.number.in.range=$&#123;random.<span class="keyword">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</div></pre></td></tr></table></figure>
<ul>
<li>random.int*语法是OPEN value (,max) CLOSE，此处OPEN，CLOSE可以是任何字符，并且value，max是整数。如果提供max，那么value是最小的值，max是最大的值（不包含在内）</li>
</ul>
<h3 id="访问命令行属性"><a href="#访问命令行属性" class="headerlink" title="访问命令行属性"></a>访问命令行属性</h3><ul>
<li><p>默认情况下，<strong>SpringApplication</strong>将任何可选的命令行参数（以’–’开头，比如，<code>--server.port=9000</code>）转化为property，并将其添加到Spring Environment中。</p>
</li>
<li><p>如上所述，命令行属性总是优先于其他属性源。</p>
</li>
<li><p>如果你不想将命令行属性添加到Environment里，你可以使用<code>SpringApplication.setAddCommandLineProperties(false)</code>来禁止它们。</p>
</li>
</ul>
<h2 id="Application属性文件"><a href="#Application属性文件" class="headerlink" title="Application属性文件"></a>Application属性文件</h2><ul>
<li>SpringApplication将从以下位置加载application.properties文件，并把它们添加到Spring<br>Environment中：</li>
</ul>
<ol>
<li>当前目录下的一个<code>/config</code>子目录</li>
<li>当前目录</li>
<li>一个classpath下的<code>/config</code>包</li>
<li><code>classpath</code>根路径（root）</li>
</ol>
<ul>
<li>这个列表是按优先级排序的（列表中位置高的将覆盖位置低的）。</li>
</ul>
<blockquote>
<p>注：你可以使用YAML（’.yml’）文件替代’.properties’。</p>
</blockquote>
<ul>
<li>如果不喜欢将application.properties作为配置文件名，<ul>
<li>你可以通过指定<code>spring.config.name</code>环境属性来切换其他的名称。</li>
<li>你也可以使用<code>spring.config.location</code>环境属性来引用一个明确的路径（目录位置或文件路径列表以逗号分割）。</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ java -jar myproject.jar --spring.config.name=myproject</div><div class="line">//or</div><div class="line">$ java -jar myproject.jar --spring.config.location=classpath:/default.properties,class</div><div class="line">path:/override.properties</div></pre></td></tr></table></figure>
<ul>
<li>如果spring.config.location包含目录（相对于文件），那它们应该以/结尾（在加载前,spring.config.name产生的名称将被追加到后面）。</li>
<li>不管spring.config.location是什么值，默认的搜索路径classpath:,classpath:/config,file:,file:config/总会被使用。</li>
<li>以这种方式，你可以在application.properties中为应用设置默认值，然后在运行的时候使用不同的文件覆盖它，同时保留默认配置。</li>
</ul>
<blockquote>
<p>注：如果你使用环境变量而不是系统配置，大多数操作系统不允许以句号分割（period-separated）的key名称，但你可以使用下划线（underscores）代替（比如，使用SPRING_CONFIG_NAME代替spring.config.name）。如果你的应用运行在一个容器中，那么JNDI属性（java:comp/env）或servlet上下文初始化参数可以用来取代环境变量或系统属性，当然也可以使用环境变量或系统属性。</p>
</blockquote>
<h2 id="特定的Profile属性"><a href="#特定的Profile属性" class="headerlink" title="特定的Profile属性"></a>特定的Profile属性</h2><ul>
<li>除了<strong>application.properties</strong>文件，特定配置属性也能通过命令惯例<code>application-{profile}.properties</code>来定义。</li>
<li>特定<code>Profile</code>属性从跟标准application.properties相同的路径加载，并且特定<code>profile</code>文件会覆盖默认的配置。</li>
</ul>
<h2 id="属性占位符"><a href="#属性占位符" class="headerlink" title="属性占位符"></a>属性占位符</h2><ul>
<li>当application.properties里的值被使用时，它们会被存在的Environment过滤，所以你能够引<br>用先前定义的值（比如，系统属性）。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">app.name=MyApp</div><div class="line">app.description=$&#123;app.name&#125; is a Spring Boot application</div></pre></td></tr></table></figure>
<h3 id="使用YAML代替Properties"><a href="#使用YAML代替Properties" class="headerlink" title="使用YAML代替Properties"></a>使用YAML代替Properties</h3><ul>
<li><p>YAML是JSON的一个超集，也是一种方便的定义层次配置数据的格式。</p>
</li>
<li><p>无论你何时将SnakeYAML库放到classpath下，SpringApplication类都会自动支持YAML作为properties的替换。</p>
</li>
</ul>
<blockquote>
<p>注：如果你使用’starter POMs’，spring-boot-starter会自动提供SnakeYAML。</p>
<p>注：你也能使用相应的技巧为存在的Spring Boot属性创建’短’变量</p>
</blockquote>
<h3 id="检查应用的运行状态。"><a href="#检查应用的运行状态。" class="headerlink" title="检查应用的运行状态。"></a>检查应用的运行状态。</h3><ul>
<li><p>(参考文章：](<a href="http://www.itnose.net/detail/6359648.html" target="_blank" rel="external">http://www.itnose.net/detail/6359648.html</a>)</p>
</li>
<li><p>compile group: ‘org.springframework.boot’, name: ‘spring-boot-starter-actuator’, version: ‘1.4.0.RELEASE’</p>
<ul>
<li>health可以用来检查应用的运行状态。</li>
<li>它经常被监控软件用来提醒人们生产系统是否停止。</li>
<li>health端点暴露的默认信息取决于端点是如何被访问的。</li>
<li>对于一个非安全，未认证的连接只返回一个简单的’status’信息。</li>
<li>对于一个安全或认证过的连接其他详细信息也会展示。</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
<th>敏感（Sensitive）</th>
</tr>
</thead>
<tbody>
<tr>
<td>autoconfig</td>
<td>显示一个auto-configuration的报告，该报告展示所有auto-configuration候选者及它们被应用或未被应用的原因</td>
<td>true</td>
</tr>
<tr>
<td>beans</td>
<td>显示一个应用中所有Spring Beans的完整列表</td>
<td>true</td>
</tr>
<tr>
<td>configprops</td>
<td>显示一个所有@ConfigurationProperties的整理列表</td>
<td>true</td>
</tr>
<tr>
<td>dump</td>
<td>执行一个线程转储true    </td>
</tr>
<tr>
<td>env</td>
<td>暴露来自Spring　ConfigurableEnvironment的属性</td>
<td>true</td>
</tr>
<tr>
<td>health</td>
<td>展示应用的健康信息（当使用一个未认证连接访问时显示一个简单的’status’，使用认证连接访问则显示全部信息详情）</td>
<td>false</td>
</tr>
<tr>
<td>info</td>
<td>显示任意的应用信息</td>
<td>false</td>
</tr>
<tr>
<td>metrics</td>
<td>展示当前应用的’指标’信息</td>
<td>true</td>
</tr>
<tr>
<td>mappings</td>
<td>显示一个所有@RequestMapping路径的整理列表</td>
<td>true</td>
</tr>
<tr>
<td>shutdown</td>
<td>允许应用以优雅的方式关闭（默认情况下不启用）</td>
<td>true</td>
</tr>
<tr>
<td>trace</td>
<td>显示trace信息（默认为最新的一些HTTP请求）</td>
<td>true</td>
</tr>
</tbody>
</table>
<h4 id="如果希望了解的更多一些，必须要试试这个参数-debug"><a href="#如果希望了解的更多一些，必须要试试这个参数-debug" class="headerlink" title="如果希望了解的更多一些，必须要试试这个参数 --debug"></a>如果希望了解的更多一些，必须要试试这个参数 <code>--debug</code></h4><h2 id="Spring-boot-整合Redis"><a href="#Spring-boot-整合Redis" class="headerlink" title="Spring boot 整合Redis"></a>Spring boot 整合Redis</h2><h3 id="引入依赖-2"><a href="#引入依赖-2" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-redis</span></div><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-redis'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<h3 id="参数配置-1"><a href="#参数配置-1" class="headerlink" title="参数配置"></a>参数配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># REDIS (RedisProperties)</div><div class="line"># Redis数据库索引（默认为0）</div><div class="line">spring.redis.database=0  </div><div class="line"># Redis服务器地址</div><div class="line">spring.redis.host=127.0.0.1  </div><div class="line"># Redis服务器连接端口</div><div class="line">spring.redis.port=6379  </div><div class="line"># Redis服务器连接密码（默认为空）</div><div class="line">spring.redis.password=  </div><div class="line"># 连接池最大连接数（使用负值表示没有限制）</div><div class="line">spring.redis.pool.max-active=8  </div><div class="line"># 连接池最大阻塞等待时间（使用负值表示没有限制）</div><div class="line">spring.redis.pool.max-wait=-1  </div><div class="line"># 连接池中的最大空闲连接</div><div class="line">spring.redis.pool.max-idle=8  </div><div class="line"># 连接池中的最小空闲连接</div><div class="line">spring.redis.pool.min-idle=0  </div><div class="line"># 连接超时时间（毫秒）</div><div class="line">spring.redis.timeout=0</div></pre></td></tr></table></figure>
<blockquote>
<p>其中spring.redis.database的配置通常使用0即可，Redis在配置的时候可以设置数据库数量，默认为16，可以理解为数据库的schema</p>
</blockquote>
<h3 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by benny on 2016/8/24.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span>(classes = BlogWebApplication.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtilTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    StringRedisTemplate stringRedisTemplate;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</div><div class="line">        stringRedisTemplate.opsForValue().set(<span class="string">"name"</span>,<span class="string">"benny"</span>);</div><div class="line">        String name = stringRedisTemplate.opsForValue().get(<span class="string">"name"</span>);</div><div class="line">        System.out.println(name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>上面的测试代码，演示了如何通过自动配置的<code>StringRedisTemplate</code>对象进行Redis的读写操作，该对象从命名中可知支持的是String类型。</li>
<li>没有使用过<strong>Spring-data-redis</strong>的人一定熟悉<code>RedisTemplate&lt;K,V&gt;</code>接口，<strong>StringRedisTemplate</strong>就相当于<code>RedisTemplate&lt;String,String&gt;</code>的实现。</li>
</ul>
<h3 id="Redis存储对象"><a href="#Redis存储对象" class="headerlink" title="Redis存储对象"></a>Redis存储对象</h3><ul>
<li>实际情况下，我们还要用<strong>Redis</strong>来存储对象，Spring Boot 并不支持直接使用<code>RedisTemplate&lt;Stirng,Object&gt;</code>需要我们自己实现 <strong>RedisSerializable<t></t></strong> 接口来对传入的对象进行序列化和反序列化。</li>
</ul>
<blockquote>
<ul>
<li>[x] 注意： 要存储的对象一定要实现<strong>Serializable</strong>接口</li>
</ul>
</blockquote>
<ul>
<li>创建要存储的对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">1L</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, Integer age)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.username = username;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 省略getter和setter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>实现对象的序列化接口 <strong>RedisSerializer<object></object></strong></p>
<ul>
<li>未对类进行重构，方便查看</li>
<li>实现了 <strong>RedisSerializer<object></object></strong> 重写了两个方法<ul>
<li>public byte[] <strong>serialize</strong>(Object o);</li>
<li>public Object <strong>deserialize</strong>(byte[] bytes);<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</div><div class="line"><span class="keyword">import</span> org.springframework.core.serializer.support.DeserializingConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.core.serializer.support.SerializingConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</div><div class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.SerializationException;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description:</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/8/24 11:52 by Benny</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisObjectSerializer</span> <span class="keyword">implements</span> <span class="title">RedisSerializer</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Converter&lt;Object, <span class="keyword">byte</span>[]&gt; serializer   = <span class="keyword">new</span> SerializingConverter();</div><div class="line">    <span class="keyword">private</span> Converter&lt;<span class="keyword">byte</span>[], Object&gt; deserializer = <span class="keyword">new</span> DeserializingConverter();</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] serialize(Object o) <span class="keyword">throws</span> SerializationException &#123;</div><div class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> serializer.convert(o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> SerializationException </span>&#123;</div><div class="line">        <span class="keyword">if</span> ((bytes == <span class="keyword">null</span> || bytes.length == <span class="number">0</span>)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> deserializer.convert(bytes);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>配置针对User的RedisTemplate实例</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</div><div class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.jedis.JedisConnectionFactory;</div><div class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</div><div class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</div><div class="line"></div><div class="line"><span class="meta">@Configuration</span>      ★★★★★ 一定要配置<span class="meta">@configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>       ★★★★★ 一定要加上注解<span class="meta">@Bean</span></div><div class="line">    <span class="function">JedisConnectionFactory <span class="title">jedisConnectionFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">        JedisConnectionFactory jedisConnectionFactory = <span class="keyword">new</span> JedisConnectionFactory();</div><div class="line">        <span class="comment">//jedisConnectionFactory.setHostName("192.168.104.139");</span></div><div class="line">        <span class="comment">//jedisConnectionFactory.setPort(6379);</span></div><div class="line">        <span class="keyword">return</span> jedisConnectionFactory;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Bean</span>       ★★★★★ 一定要加上注解<span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, User&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</div><div class="line">        </div><div class="line">        RedisTemplate&lt;String, User&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</div><div class="line">        </div><div class="line">        template.setConnectionFactory(jedisConnectionFactory());</div><div class="line">        </div><div class="line">        template.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</div><div class="line">        <span class="comment">//传入自定义序列化类</span></div><div class="line">        template.setValueSerializer(<span class="keyword">new</span> RedisObjectSerializer());</div><div class="line">        <span class="keyword">return</span> template;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>测试用例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span>(classes = BlogWebApplication.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtilTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    RedisTemplate&lt;String, User&gt; redisTemplate;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</div><div class="line">        User user = <span class="keyword">new</span> User();</div><div class="line">        user.setUserId(<span class="string">"14"</span>);</div><div class="line">        user.setUserName(<span class="string">"benny"</span>);</div><div class="line">        user.setPassword(<span class="string">"123456"</span>);</div><div class="line">        user.setDisplayNum(<span class="number">12</span>);</div><div class="line">        redisTemplate.opsForValue().set(<span class="string">"user"</span>,user);</div><div class="line">        User u = redisTemplate.opsForValue().get(<span class="string">"user"</span>);</div><div class="line">        Assert.assertEquals(<span class="string">"benny"</span>,u.getUserName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Spring-Boot-使用Redis作为缓存"><a href="#Spring-Boot-使用Redis作为缓存" class="headerlink" title="Spring Boot 使用Redis作为缓存"></a>Spring Boot 使用Redis作为缓存</h2><h3 id="引入依赖-3"><a href="#引入依赖-3" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//  spring-boot-starter-cache</span></div><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-cache'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div><div class="line"></div><div class="line"><span class="comment">//  spring-boot-starter-redis</span></div><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-redis'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<h3 id="参数配置-2"><a href="#参数配置-2" class="headerlink" title="参数配置"></a>参数配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># REDIS (RedisProperties)</div><div class="line"># Redis数据库索引（默认为0）</div><div class="line">spring.redis.database=0  </div><div class="line"># Redis服务器地址</div><div class="line">spring.redis.host=127.0.0.1  </div><div class="line"># Redis服务器连接端口</div><div class="line">spring.redis.port=6379  </div><div class="line"># Redis服务器连接密码（默认为空）</div><div class="line">spring.redis.password=  </div><div class="line"># 连接池最大连接数（使用负值表示没有限制）</div><div class="line">spring.redis.pool.max-active=8  </div><div class="line"># 连接池最大阻塞等待时间（使用负值表示没有限制）</div><div class="line">spring.redis.pool.max-wait=-1  </div><div class="line"># 连接池中的最大空闲连接</div><div class="line">spring.redis.pool.max-idle=8  </div><div class="line"># 连接池中的最小空闲连接</div><div class="line">spring.redis.pool.min-idle=0  </div><div class="line"># 连接超时时间（毫秒）</div><div class="line">spring.redis.timeout=0</div></pre></td></tr></table></figure>
<h3 id="编写RedisCacheConfig配置类："><a href="#编写RedisCacheConfig配置类：" class="headerlink" title="编写RedisCacheConfig配置类："></a>编写RedisCacheConfig配置类：</h3><blockquote>
<p>缓存主要有几个要实现的类：</p>
</blockquote>
<ul>
<li>一、是CacheManager缓存管理器</li>
<li>二、是具体操作实现类</li>
<li>三、是CacheManager工厂类（这个可以使用配置文件配置的进行注入，也可以通过编码的方式进行实现）；</li>
<li>四、是缓存key生产策略（当然Spring自带生成策略，但是在Redis客户端进行查看的话是系列化的key,对于我们肉眼来说就是感觉是乱码了，这里我们先使用自带的缓存策略）。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableCaching</span>          <span class="comment">// ★★★★★ 启用注解，这个注解很重要</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCacheConfig</span> <span class="keyword">extends</span>  </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function">JedisConnectionFactory <span class="title">jedisConnectionFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">        JedisConnectionFactory jedisConnectionFactory = <span class="keyword">new</span> JedisConnectionFactory();</div><div class="line">        <span class="comment">//jedisConnectionFactory.setHostName("你的IP地址");</span></div><div class="line">        <span class="comment">//jedisConnectionFactory.setPort(6379);</span></div><div class="line">        <span class="keyword">return</span> jedisConnectionFactory;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * redis模板操作类,类似于jdbcTemplate的一个类;</div><div class="line">     * 虽然CacheManager也能获取到Cache对象，但是操作起来没有那么灵活；</div><div class="line">     * 这里在扩展下：RedisTemplate这个类不见得很好操作，我们可以在进行扩展一个我们</div><div class="line">     * 自己的缓存类，比如：RedisStorage类;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> redisConnectionFactory : 通过Spring进行注入，参数在application.properties进行配置；</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, User&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</div><div class="line"></div><div class="line">        RedisTemplate&lt;String, User&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</div><div class="line">        template.setConnectionFactory(jedisConnectionFactory());</div><div class="line">        template.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</div><div class="line">        <span class="comment">//传入自定义序列化类</span></div><div class="line">        template.setValueSerializer(<span class="keyword">new</span> RedisObjectSerializer());</div><div class="line">        <span class="keyword">return</span> template;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*-----------------------------  缓存使用 --------------------------------   */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 缓存管理器</div><div class="line">     * <span class="doctag">@param</span> redisTemplate</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisTemplate&lt;?, ?&gt; redisTemplate)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisCacheManager(redisTemplate);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 自定义key.</div><div class="line">     * 此方法将会根据类名+方法名+所有参数的值生成唯一的一个key,即使<span class="doctag">@Cacheable</span>中的value属性一样，key也会不一样。</div><div class="line">     * @ Return</div><div class="line">     */</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> KeyGenerator <span class="title">keyGenerator</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KeyGenerator() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object target, Method method, Object... params)</span> </span>&#123;</div><div class="line">                StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">                sb.append(target.getClass().getName());</div><div class="line">                sb.append(method.getName());</div><div class="line">                <span class="keyword">for</span> (Object obj : params) &#123;</div><div class="line">                    sb.append(obj.toString());</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> sb.toString();</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Redis-缓存配置"><a href="#Redis-缓存配置" class="headerlink" title="Redis 缓存配置:"></a>Redis 缓存配置:</h4><blockquote>
<p>注意：</p>
</blockquote>
<ul>
<li><strong>RedisCacheConfig</strong>类这里也可以不用继承<strong>CachingConfigurerSupport</strong>类，也就是直接一个普通的Class就好了；<ul>
<li>这里主要我们之后要重新实现<strong>key</strong>的生成策略，只要这里修改<strong>KeyGenerator</strong>，其它位置不用修改就生效了。</li>
<li>普通使用普通类的方式的话，那么在使用<code>@Cacheable</code>的时候还需要指定<strong>KeyGenerator</strong>的名称;这样编码的时候比较麻烦。</li>
</ul>
</li>
</ul>
<h3 id="添加注解-Cacheable-…"><a href="#添加注解-Cacheable-…" class="headerlink" title="添加注解@Cacheable(…)"></a>添加注解@Cacheable(…)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Service</span>(<span class="string">"userServiceImpl"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    UserService userServiceImpl;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 注意：       ★★★★★★★</div><div class="line">     *</div><div class="line">     * 如果 RedisCacheConfig.java类不继承 CachingConfigurerSupport.java类的话</div><div class="line">     * <span class="doctag">@Cacheable</span>(value = "user" , keyGenerator = "keyGenerator" ) 中的keyGenerator就必须要手动指定</div><div class="line">     * 如过继承了CachingConfigurerSupport.java类的话，则可以省略写keyGenerator属性，像下面的代码</div><div class="line">     *</div><div class="line">     */</div><div class="line">    <span class="meta">@Cacheable</span>(value = <span class="string">"users"</span>)</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"从数据库中获取的User"</span>);</div><div class="line">        <span class="keyword">return</span> userDaoImpl.findAll();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="缓存的生命周期"><a href="#缓存的生命周期" class="headerlink" title="缓存的生命周期"></a>缓存的生命周期</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Hibernate: insert into user (age, name) values (?, ?)  </div><div class="line">Hibernate: select user0_.id as id1_0_, user0_.age as age2_0_, user0_.name as name3_0_fromuseruser0_user0_.name=?</div><div class="line">第一次查询：10</div><div class="line">Hibernate: select user0_.id as id1_0_0_,user0_.ageasage2_0_0_,user0_.nameasname3_0_0_fromuseruser0_user0_.id=?</div><div class="line">第二次查询：10</div><div class="line">Hibernate: update user  age = 20, name=? id=?  </div><div class="line">第三次查询：10</div></pre></td></tr></table></figure>
<blockquote>
<p>可以观察到:</p>
</blockquote>
<ul>
<li>第一次查询的时候，执行了select语句</li>
<li>第二次查询没有执行select语句，说明是从缓存中获得了结果；</li>
<li>第三次查询，我们获得了一个错误的结果，根据我们的测试逻辑，在查询之前我们已经将age更新为20，但是我们从缓存中获取到的age还是为10。</li>
</ul>
<ul>
<li>[x] 在EhCache中没有这个问题，在Redis中出现了这个问题；</li>
</ul>
<ul>
<li>因为Redis的缓存独立于我们的Spring应用之外，我们对数据库中数据做了更新以后，没有通知Redis去更新相应的内容，因此我们取到了缓存中为修改的数据，导致了数据库与缓存中的数据不一致。</li>
<li>所以在使用缓存的时候，要注意缓存的声明周期</li>
</ul>
<h3 id="缓存注解-Cacheable、-CachePut、-CacheEvict"><a href="#缓存注解-Cacheable、-CachePut、-CacheEvict" class="headerlink" title="缓存注解 @Cacheable、@CachePut、@CacheEvict"></a>缓存注解 @Cacheable、@CachePut、@CacheEvict</h3><blockquote>
<p><strong>@Cacheable</strong>、<strong>@CachePut</strong>、<strong>@CacheEvict</strong> 注释介绍</p>
</blockquote>
<ul>
<li>[x] <strong>@Cacheable</strong> 的作用 主要针对方法配置，能够根据方法的请求参数对其结果进行缓存</li>
</ul>
<table>
<thead>
<tr>
<th>可设置属性</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>缓存的名称，在spring配置文件中定义，必须指定至少一个</td>
<td>例如：@Cacheable(value=”mycache”) 或者 @Cacheable(value={”cache1”,”cache2”}</td>
</tr>
<tr>
<td>key</td>
<td>缓存的 key，可以为空，如果指定要按照SpEL表达式编写，如果不指定，则缺省按照方法的所有参数进行组合</td>
<td>例如：@Cacheable(value=”testcache”,key=”#userName”)</td>
</tr>
<tr>
<td>condition</td>
<td>缓存的条件，可以为空，使用 SpEL 编写，返回true或者false，只有为true才进行缓存</td>
<td>例如：@Cacheable(value=”testcache”,condition=”#userName.length()&gt;2”)</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>[x] <strong>@CachePut</strong> 的作用主要针对方法配置，能够根据方法的请求参数对其结果进行缓存，和 <strong>@Cacheable</strong> 不同的是，它每次都会触发真实方法的调用</li>
</ul>
<table>
<thead>
<tr>
<th>可设置属性</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>缓存的名称，在spring配置文件中定义，必须指定至少一个</td>
<td>例如：@Cacheable(value=”mycache”) 或者 @Cacheable(value={”cache1”,”cache2”}</td>
</tr>
<tr>
<td>key</td>
<td>缓存的 key，可以为空，如果指定要按照SpEL表达式编写，如果不指定，则缺省按照方法的所有参数进行组合</td>
<td>例如：@Cacheable(value=”testcache”,key=”#userName”)</td>
</tr>
<tr>
<td>condition</td>
<td>缓存的条件，可以为空，使用 SpEL 编写，返回 true 或者false，只有为true才进行缓存</td>
<td>例如：@Cacheable(value=”testcache”,condition=”#userName.length()&gt;2”)</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>[x] <strong>@CacheEvict</strong> 的作用主要针对方法配置，能够根据一定的条件对缓存进行清空 <strong>@CacheEvict</strong> 主要的参数</li>
</ul>
<table>
<thead>
<tr>
<th>可设置属性</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>缓存的名称，在spring配置文件中定义，必须指定至少一个</td>
<td>例如：@CachEvict(value=”mycache”) 或者 @CachEvict(value={”cache1”,”cache2”}</td>
</tr>
<tr>
<td>key</td>
<td>缓存的 key，可以为空，如果指定要按照SpEL表达式编写，如果不指定，则缺省按照方法的所有参数进行组合</td>
<td>例如：@CachEvict(value=”testcache”,key=”#userName”)</td>
</tr>
<tr>
<td>condition</td>
<td>缓存的条件，可以为空，使用 SpEL 编写，返回 true 或者false，只有为true才清空缓存</td>
<td>例如：@CachEvict(value=”testcache”,condition=”#userName.length()&gt;2”)</td>
</tr>
<tr>
<td>allEntries</td>
<td>是否清空所有缓存内容，缺省为false，如果指定为true，则方法调用后将立即清空所有缓存</td>
<td>例如：@CachEvict(value=”testcache”,allEntries=true)</td>
</tr>
<tr>
<td>beforeInvocation</td>
<td>是否在方法执行前就清空，缺省为false，如果指定为true，则在方法还没有执行的时候就清空缓存，缺省情况下，如果方法执行抛出异常，则不会清空缓存</td>
<td>例如：@CachEvict(value=”testcache”，beforeInvocation=true)</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>[x] @<strong>Caching</strong>有时候我们可能组合多个Cache注解使用；</li>
</ul>
<ul>
<li>比如用户新增成功后，我们要添加id–&gt;user；username—&gt;user；email—&gt;user的缓存;就是查询的时候可以根据用户名或邮箱，或密码来查询，此时就需要@Caching组合多个注解标签了。</li>
<li>如用户新增成功后，添加id–&gt;user；username—&gt;user；email—&gt;user到缓存； </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Caching</span>(  </div><div class="line">        put = &#123;  </div><div class="line">                <span class="meta">@CachePut</span>(value = <span class="string">"user"</span>, key = <span class="string">"#user.id"</span>),  </div><div class="line">                <span class="meta">@CachePut</span>(value = <span class="string">"user"</span>, key = <span class="string">"#user.username"</span>),  </div><div class="line">                <span class="meta">@CachePut</span>(value = <span class="string">"user"</span>, key = <span class="string">"#user.email"</span>)  </div><div class="line">        &#125;  </div><div class="line">)  </div><div class="line"><span class="function"><span class="keyword">public</span> User <span class="title">save</span><span class="params">(User user)</span> </span>&#123;</div></pre></td></tr></table></figure>
<blockquote>
<p>额外补充：</p>
</blockquote>
<ul>
<li>@cache(“something”) 这个相当于 save() 操作</li>
<li>@cachePut 相当于 Update() 操作，只要他标示的方法被调用，那么都会缓存起来</li>
<li>@cache 是先看下有没已经缓存了，然后再选择是否执行方法。</li>
<li>@CacheEvict 相当于 Delete() 操作,用来清除缓存用的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Service</span>  </div><div class="line"><span class="meta">@Cacheable</span>  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemcachedService</span></span>&#123;  </div><div class="line">  <span class="meta">@Cacheable</span>(name=<span class="string">"remote"</span>,key=<span class="string">"'USER_NAME_'+#args[0]"</span>)  </div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">storeUserName</span><span class="params">(String accountId,String name)</span>  </span></div><div class="line">&#123;  </div><div class="line">  <span class="keyword">return</span> name;  </div><div class="line">&#125;  </div><div class="line">  <span class="meta">@Cacheable</span>(name=<span class="string">"remote"</span>)  </div><div class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">storeUserAddress</span><span class="params">(String accountId,String address)</span></span>&#123;  </div><div class="line">   <span class="keyword">return</span> address;  </div><div class="line">  &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用注解-CacheConfig"><a href="#使用注解-CacheConfig" class="headerlink" title="使用注解@CacheConfig"></a>使用注解@CacheConfig</h3><ul>
<li><p>所有的@Cacheable() 里面都有一个name＝”xxx”的属性，这显然如果方法多了，看起来肯定是不够优雅而且又烦的，如果可以一次性声明完 那就省事了，</p>
</li>
<li><p>所以，有了@CacheConfig这个配置，</p>
</li>
</ul>
<pre><code>@CacheConfig is a class-level annotation that allows to share the cache names
</code></pre><blockquote>
<ul>
<li>[x] 不过不用担心，如果你在你的方法写别的名字，那么依然以方法的名字为准。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@CacheConfig</span>(<span class="string">"books"</span>)  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">BookRepository</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="meta">@Cacheable</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn)</span> </span>&#123;...&#125;  </div><div class="line">    </div><div class="line">    <span class="meta">@Cacheable</span>()  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">storeUserAddress</span><span class="params">(String accountId,String address)</span></span>&#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Cacheable</span>(name = <span class="string">"book"</span>, key=<span class="string">"#isbn"</span>，conditional＝“xxx”，allEntries＝<span class="keyword">true</span>，beforeInvocation＝<span class="keyword">true</span>) </div><div class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn, <span class="keyword">boolean</span> checkWarehouse, <span class="keyword">boolean</span> includeUsed)</span></span></div></pre></td></tr></table></figure>
<ul>
<li>这样的配置很长，而且有可能声明在很多个方法的，所以我们很想精简点使用自定义注解，容易配置些。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@findBookByIsbnervice</span></div><div class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn, <span class="keyword">boolean</span> checkWarehouse, <span class="keyword">boolean</span> includeUsed)</span></span></div></pre></td></tr></table></figure>
<ul>
<li>新建一个文件findBookByIsbn,内容如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">@Target(&#123;ElementType.METHOD&#125;)</div><div class="line">@Cacheable(cacheNames=&quot;books&quot;, key=&quot;#isbn&quot;)</div><div class="line">public @interface findBookByIsbn &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>key对应的是一样的，value对应的实际是返回值。 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="meta">@Cacheable</span>(key=<span class="string">"#userId"</span>,value=<span class="string">"user"</span>)</div><div class="line">   <span class="function"><span class="keyword">public</span> User <span class="title">selectByPrimaryKey</span><span class="params">(String userId)</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"从数据库中查询到的用户信息"</span>);</div><div class="line">       <span class="keyword">return</span> userDaoImpl.selectByPrimaryKey(userId);</div><div class="line">   &#125;</div><div class="line"></div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="meta">@CachePut</span>(key = <span class="string">"#record.userId"</span>, value = <span class="string">"user"</span>)</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(User record)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> userDaoImpl.updateByPrimaryKey(record);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="总算明白了-Cacheable注解如何缓存"><a href="#总算明白了-Cacheable注解如何缓存" class="headerlink" title="总算明白了@Cacheable注解如何缓存"></a>总算明白了@Cacheable注解如何缓存</h2><h3 id="缓存自定义对象"><a href="#缓存自定义对象" class="headerlink" title="缓存自定义对象"></a>缓存自定义对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> com.okjava.service.impl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</div><div class="line"><span class="keyword">import</span> com.okjava.beans.User;</div><div class="line"><span class="keyword">import</span> com.okjava.core.pageutil.PageBean;</div><div class="line"><span class="keyword">import</span> com.okjava.mappermy.UserDao;</div><div class="line"><span class="keyword">import</span> com.okjava.service.UserService;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheConfig;</div><div class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</div><div class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> by benny on 2016/8/21.</div><div class="line"> * <span class="doctag">@version</span> 1.0</div><div class="line"> * <span class="doctag">@description</span></div><div class="line"> */</div><div class="line"><span class="meta">@Service</span>(<span class="string">"userServiceImpl"</span>)</div><div class="line"><span class="meta">@CacheConfig</span>(cacheNames = <span class="string">"userCache"</span>)             ① ★★★★★此处必须要配置否则报错</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    UserService userServiceImpl;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="meta">@Cacheable</span>(key = <span class="string">"'user:list'"</span>, sync = <span class="keyword">true</span>)    ② ★★★★★ <span class="string">'user:list'</span> 外面要有单引号</div><div class="line">    <span class="function"><span class="keyword">public</span> PageBean&lt;User&gt; <span class="title">findAllPager</span><span class="params">(PageBean pageBean)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"从数据库中获取的User"</span>);</div><div class="line">        <span class="keyword">int</span> pageSize = pageBean.getPageSize() == <span class="number">0</span> ? <span class="number">10</span> : pageBean.getPageSize();</div><div class="line">        <span class="keyword">int</span> pageNum = pageBean.getPageNum() == <span class="number">0</span> ? <span class="number">1</span> : pageBean.getPageNum();</div><div class="line">        PageHelper.startPage(pageNum, pageSize);</div><div class="line">        List&lt;User&gt; users = userDaoImpl.findAll();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageBean(users);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
</blockquote>
<p>如果要缓存的实现类类中没有加上<code>@CacheConfig</code>注解，<strong>①</strong>的位置，会抛异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">At least one cache should be provided per cache operation.</div></pre></td></tr></table></figure>
<h3 id="Spirng-Cache-Cacheable注解的key问题"><a href="#Spirng-Cache-Cacheable注解的key问题" class="headerlink" title="Spirng Cache @Cacheable注解的key问题"></a>Spirng Cache @Cacheable注解的key问题</h3><ul>
<li>加上注解 <code>@CacheConfig(cacheNames = &quot;userCache&quot;)</code></li>
<li>Spring Cache 中注解的<strong>key</strong>是可以随意指定的(重点在于 key=” “)这中间是否有一对单引号。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Cacheable</span>(key=<span class="string">"'hello'"</span>)</div><div class="line"><span class="meta">@Cacheable</span>(key=<span class="string">"hello"</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>这两个是不一样的，目前来看的话总结如下</p>
</blockquote>
<ul>
<li>自己随意定义的注解要加上<code>&#39; &#39;</code>单引号。如：@Cacheable(“ <strong>‘</strong> benny <strong>‘</strong> “)</li>
<li>如果使用spel或者ognl的话，就不需要加单引号。如：@Cacheable(“#userId”)</li>
</ul>
<h2 id="获取所有定义的Bean"><a href="#获取所有定义的Bean" class="headerlink" title="获取所有定义的Bean"></a>获取所有定义的Bean</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">String[] beanDefinitionNames = run.getBeanDefinitionNames();</div><div class="line">		<span class="keyword">for</span> (String beanDefinitionName : beanDefinitionNames) &#123;</div><div class="line">			System.out.print(beanDefinitionName + <span class="string">";"</span>);</div><div class="line">		&#125;</div></pre></td></tr></table></figure>
<h2 id="基于Spring提供支持不同设备的页面"><a href="#基于Spring提供支持不同设备的页面" class="headerlink" title="基于Spring提供支持不同设备的页面"></a>基于Spring提供支持不同设备的页面</h2><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-mobile'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<ul>
<li>Spring Boot能够针对不同设备渲染不同的视图（View），只需要在应用的Properties文件中中稍加配置即可。在application.properties增加一行：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">spring.mobile.devicedelegatingviewresolver.enabled: <span class="keyword">true</span></div></pre></td></tr></table></figure>
<p>针对一个请求，LiteDeviceDelegatingViewResolver通过DeviceResolverHandlerInterceptor识别出的Device类型来判断返回哪种视图进行响应（桌面、手机(mobile)还是平板(tablet)），这一部分大家参考Spring如何识别设备的经验。</p>
<p>LiteDeviceDelegatingViewResolver会将请求代理给ThymeleafViewResolver，作为Spring自身提供的正牌ViewResolver，相比传统的视图技术如JSP，Velocity等，有不少过人之处，大家可以回顾一下Thymeleaf的介绍以及如何在Spring MVC中使用Thymeleaf。默认情况下，Spring Boot去到mobile/和tablet/文件下去寻找移动端和平板端对应的视图进行渲染。</p>
<ul>
<li>当然你也可以在属性文件中进行设置，约定大于配置，没有特别需求用约定就好了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">└── src</div><div class="line">    └── main</div><div class="line">        └── resources</div><div class="line">            └── templates</div><div class="line">                └── sayHello.html</div><div class="line">                └── mobile</div><div class="line">                    └── sayHello.html</div><div class="line">                └── tablet</div><div class="line">                    └── sayHello.html</div></pre></td></tr></table></figure>
<h2 id="创建定时任务"><a href="#创建定时任务" class="headerlink" title="创建定时任务"></a>创建定时任务</h2><h3 id="在Spring-Boot的主类中加入-EnableScheduling注解，启用定时任务的配置"><a href="#在Spring-Boot的主类中加入-EnableScheduling注解，启用定时任务的配置" class="headerlink" title="在Spring Boot的主类中加入@EnableScheduling注解，启用定时任务的配置"></a>在Spring Boot的主类中加入<code>@EnableScheduling</code>注解，启用定时任务的配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="meta">@EnableScheduling</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SpringApplication.run(Application.class, args);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="创建定时任务实现类"><a href="#创建定时任务实现类" class="headerlink" title="创建定时任务实现类"></a>创建定时任务实现类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> by benny on 2016/8/28.</div><div class="line"> * <span class="doctag">@version</span> 1.0</div><div class="line"> * <span class="doctag">@description</span></div><div class="line"> */</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleTaskTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Scheduled</span>(fixedRate=<span class="number">2000</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</div><div class="line">        System.out.println(<span class="string">"大家好：我是serviceModule中"</span>);</div><div class="line">        System.out.println(<span class="string">"要运行我，要先添加service到web依赖中"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>运行程序，控制台中可以看到类似如下输出，定时任务开始正常运作了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">大家好：我是serviceModule中</div><div class="line">要运行我，要先添加service到web依赖中</div><div class="line">Disconnected from the target VM, address: <span class="string">'127.0.0.1:60530'</span>, transport: <span class="string">'socket'</span></div><div class="line"></div><div class="line">Process finished with exit code -<span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="Scheduled详解"><a href="#Scheduled详解" class="headerlink" title="@Scheduled详解"></a>@Scheduled详解</h3><table>
<thead>
<tr>
<th>注解参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Scheduled(fixedRate = 5000)</td>
<td>上一次开始执行时间点之后5秒再执行</td>
</tr>
<tr>
<td>@Scheduled(fixedDelay = 5000)</td>
<td>上一次执行完毕时间点之后5秒再执行</td>
</tr>
<tr>
<td>@Scheduled(initialDelay=1000,fixedRate=5000)</td>
<td>第一次延迟1秒后执行，之后按fixedRate的规则每5秒执行一次</td>
</tr>
<tr>
<td>@Scheduled(cron=<code>&quot;*/5 * * * * * *&quot;</code>)</td>
<td>通过cron表达式定义规则</td>
</tr>
</tbody>
</table>
<h3 id="cron-详解"><a href="#cron-详解" class="headerlink" title="cron 详解"></a>cron 详解</h3><ul>
<li>每个cron任务的格式如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">cron = <span class="string">"  *     *     *     *    *     *     *(可选值)  "</span></div><div class="line">         &lt;秒&gt; &lt;分钟&gt; &lt;小时&gt; &lt;日&gt; &lt;月&gt; &lt;星期&gt; &lt;年&gt;【可选值】</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>匹配该域的任意值；如*用在分所在的域，表示每分钟都会触发事件。</td>
</tr>
<tr>
<td><code>?</code></td>
<td>匹配该域的任意值。</td>
</tr>
<tr>
<td><code>-</code></td>
<td>匹配一个特定的范围值；如时所在的域的值是10-12，表示10、11、12点的时候会触发事件。</td>
</tr>
<tr>
<td><code>,</code></td>
<td>匹配多个指定的值；如周所在的域的值是2,4,6，表示在周一、周三、周五就会触发事件(1表示周日，2表示周一，3表示周二，以此类推，7表示周六)。</td>
</tr>
<tr>
<td><code>/</code></td>
<td>左边是开始触发时间，右边是每隔固定时间触发一次事件，如秒所在的域的值是5/15，表示5秒、20秒、35秒、50秒的时候都触发一次事件。</td>
</tr>
<tr>
<td><code>L</code></td>
<td>last，最后的意思，如果是用在天这个域，表示月的最后一天，如果是用在周所在的域，如6L，表示某个月最后一个周五。（外国周日是星耀日，周一是月耀日，一周的开始是周日，所以1L=周日，6L=周五。）</td>
</tr>
<tr>
<td><code>W</code></td>
<td>weekday，工作日的意思。如天所在的域的值是15W，表示本月15日最近的工作日，如果15日是周六，触发器将触发上14日周五。如果15日是周日，触发器将触发16日周一。如果15日不是周六或周日，而是周一至周五的某一个，那么它就在15日当天触发事件。</td>
</tr>
<tr>
<td><code>#</code></td>
<td>用来指定每个月的第几个星期几，如6#3表示某个月的第三个星期五。</td>
</tr>
</tbody>
</table>
<p>下面是一些<strong>cron</strong>任务示例。</p>
<table>
<thead>
<tr>
<th>注解参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><em> </em> <em> </em> <em> </em></td>
<td>每分钟运行。</td>
</tr>
<tr>
<td>0 <em> </em> <em> </em> *</td>
<td>每小时运行。</td>
</tr>
<tr>
<td>0 0 <em> </em> <em> </em></td>
<td>每天零点运行。</td>
</tr>
<tr>
<td>0 9,18 <em> </em> <em> </em></td>
<td>在每天的9AM和6PM运行。</td>
</tr>
<tr>
<td>0 9-18 <em> </em> <em> </em></td>
<td>在9AM到6PM的每个小时运行。</td>
</tr>
<tr>
<td>0 9-18 <em> </em> 1-5 *</td>
<td>周一到周五的9AM到6PM每小时运行。</td>
</tr>
<tr>
<td><em>/10 </em> <em> </em> <em> </em></td>
<td>每10分钟运行。</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## Spring boot 整合 Spring Security</div><div class="line"></div><div class="line">### 添加依赖</div><div class="line"></div><div class="line">```java</div><div class="line"></div><div class="line">//spring security</div><div class="line">compile group: &apos;org.springframework.boot&apos;, name: &apos;spring-boot-starter-security&apos;, version: &apos;1.4.0.RELEASE&apos;</div></pre></td></tr></table></figure>
<h3 id="创建Spring-Security的配置类WebSecurityConfig"><a href="#创建Spring-Security的配置类WebSecurityConfig" class="headerlink" title="创建Spring Security的配置类WebSecurityConfig"></a>创建Spring Security的配置类WebSecurityConfig</h3><ul>
<li>通过<code>@EnableWebSecurity</code>注解开启Spring Security的功能</li>
<li>继承<strong>WebSecurityConfigurerAdapter</strong>，并重写它的方法来设置一些web安全的细节<code>configure(HttpSecurity http)</code>方法</li>
<li>通过<code>authorizeRequests()</code>定义哪些URL需要被保护、哪些不需要被保护。<ul>
<li>例如以上代码指定了/和/home+ 不需要任何认证就可以访问，其他的路径都必须通过身份验证。</li>
</ul>
</li>
<li>通过<code>formLogin()</code>定义当需要用户登录时候，转到的登录页面。</li>
<li><p><code>configure(AuthenticationManagerBuilder auth)</code>方法，在内存中创建了一个用户，该用户的名称为user，密码为password，用户角色为USER。</p>
</li>
<li><p>代码如下：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description:</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/8/31 9:57 by Benny</div><div class="line"> */</div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableWebSecurity</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">       http</div><div class="line">            .authorizeRequests()</div><div class="line">                .antMatchers(<span class="string">"/"</span>, <span class="string">"/home"</span>).permitAll()</div><div class="line">                .anyRequest().authenticated()</div><div class="line">                .and()</div><div class="line">            .formLogin()</div><div class="line">                .loginPage(<span class="string">"/login"</span>)</div><div class="line">                .permitAll()</div><div class="line">                .and()</div><div class="line">            .logout()</div><div class="line">                .permitAll();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        auth.inMemoryAuthentication().withUser(<span class="string">"user"</span>).password(<span class="string">"password"</span>).roles(<span class="string">"USER"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>WebSecurityConfigurerAdapter</strong>在<code>config(HttpSecurity  http)</code>方法提供了一个默认的配置，</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">protected void configure(HttpSecurity http) throws Exception &#123;</div><div class="line">    http</div><div class="line">        .authorizeRequests()</div><div class="line">            .anyRequest().authenticated()</div><div class="line">            .and()</div><div class="line">        .formLogin()</div><div class="line">            .and()</div><div class="line">        .httpBasic();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>[x] 上面的配置等同于<ul>
<li>确保我们应用中的所有请求都需要用户被认证</li>
<li>允许用户进行基于表单的认证</li>
<li>允许用户使用HTTP基本验证进行认证</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;http&gt;</div><div class="line">    &lt;intercept-url pattern="/**" access="authenticated"/&gt;</div><div class="line">    &lt;form-login /&gt;</div><div class="line">    &lt;http-basic /&gt;</div><div class="line">&lt;/http&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>java配置使用and()方法相当于XML标签的关闭，这样允许我们继续配置父类节点。</p>
</blockquote>
<h3 id="指定登录页地址"><a href="#指定登录页地址" class="headerlink" title="指定登录页地址"></a>指定登录页地址</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    http</div><div class="line">        .authorizeRequests()</div><div class="line">            .anyRequest().authenticated()</div><div class="line">            .and()</div><div class="line">        .formLogin()</div><div class="line">            .loginPage(<span class="string">"/login"</span>) <span class="comment">//注 ①①⑴</span></div><div class="line">            .permitAll();        <span class="comment">//注②</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>1、指定登录页地址</li>
<li>2、我们必须允许所有用户访问我们的登录页 (例如未验证的用户)<br><code>formLogin()</code><strong>.permitAll()</strong> 方法允许基于表单登陆的所有URL的所有用户的访问。<br>登陆也配置示例：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;c:url value="/login" var="loginUrl"/&gt;</div><div class="line">    &lt;form action="$&#123;loginUrl&#125;" method="post"&gt;   &lt;!-- 1 --&gt;</div><div class="line">        &lt;c:if test="$&#123;param.error != null&#125;"&gt;     &lt;!-- 2  --&gt;</div><div class="line">            &lt;p&gt;</div><div class="line">                Invalid username and password.</div><div class="line">            &lt;/p&gt;</div><div class="line">        &lt;/c:if&gt;</div><div class="line">        &lt;c:if test="$&#123;param.logout != null&#125;"&gt;    &lt;!-- 3  --&gt;</div><div class="line">            &lt;p&gt;</div><div class="line">                You have been logged out.</div><div class="line">            &lt;/p&gt;</div><div class="line">        &lt;/c:if&gt;</div><div class="line">        &lt;p&gt;</div><div class="line">            &lt;label for="username"&gt;Username&lt;/label&gt;</div><div class="line">            &lt;input type="text" id="username" name="username"/&gt;&lt;!-- 4  --&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;p&gt;</div><div class="line">            &lt;label for="password"&gt;Password&lt;/label&gt;</div><div class="line">            &lt;input type="password" id="password" name="password"/&gt;&lt;!-- 5  --&gt;    &lt;/p&gt;</div><div class="line">        &lt;input type="hidden"  </div><div class="line">            name="$&#123;_csrf.parameterName&#125;"</div><div class="line">            value="$&#123;_csrf.token&#125;"/&gt;&lt;!-- 6  --&gt;</div><div class="line">        &lt;button type="submit" class="btn"&gt;Log in&lt;/button&gt;</div><div class="line">    &lt;/form&gt;</div></pre></td></tr></table></figure>
<ol>
<li>一个POST请求到/login用来验证用户</li>
<li>如果参数有错误，验证尝试失败</li>
<li>如果请求参数logout存在则登出</li>
<li>登录名参数必须被命名为username</li>
<li>密码参数必须被命名为password</li>
<li>CSRF参数，了解更多查阅 后续“包含CSRF Token” 和 “跨站请求伪造(CSRF)”相关章节</li>
</ol>
<h2 id="Spring-boot-过滤器-拦截器"><a href="#Spring-boot-过滤器-拦截器" class="headerlink" title="Spring boot 过滤器 拦截器"></a>Spring boot 过滤器 拦截器</h2><h3 id="自定义过滤器类"><a href="#自定义过滤器类" class="headerlink" title="自定义过滤器类"></a>自定义过滤器类</h3><ol>
<li>定义一个类 <strong>MyFilter  继承  Filter</strong>（<code>import javax.servlet.Filter</code>）</li>
<li>在类上添加 注解 <code>@WebFilter(filterName = &quot;myFilter&quot;,urlPatterns = &quot;/*&quot;)</code></li>
<li>在启动类<strong>SpringBootApplication</strong>上添加 注解 <code>@ServletComponentScan</code> </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> com.okjava.filter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.*;</div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description:</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/8/31 15:58 by Benny</div><div class="line"> */</div><div class="line"><span class="meta">@WebFilter</span>(filterName = <span class="string">"myFilter"</span>,urlPatterns = <span class="string">"/*"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"过滤器初始化"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"执行过滤器"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"过滤器销毁"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>SpringBoot启动类<code>SpringBootApplication</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</div><div class="line"></div><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="meta">@ServletComponentScan</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogWebApplication</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		SpringApplication.run(BlogWebApplication.class, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ServletContext监听器（Listener）ServletContextListener"><a href="#ServletContext监听器（Listener）ServletContextListener" class="headerlink" title="ServletContext监听器（Listener）ServletContextListener"></a>ServletContext监听器（Listener）<code>ServletContextListener</code></h3><ol>
<li>定义一个类 <strong>MyServletContextListener   实现  ServletContextListener</strong>（<code>import javax.servlet.ServletContextListener</code>）</li>
<li>在类上添加 注解 <code>@WebListener</code></li>
<li>在启动类<strong>SpringBootApplication</strong>上添加 注解 <code>@ServletComponentScan</code> </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</div><div class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description:</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/8/31 16:09 by Benny</div><div class="line"> */</div><div class="line"><span class="meta">@WebListener</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"ServletContext初始化"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"ServletContext销毁"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ServletContext监听器（Listener）-HttpSessionListener"><a href="#ServletContext监听器（Listener）-HttpSessionListener" class="headerlink" title="ServletContext监听器（Listener） HttpSessionListener"></a>ServletContext监听器（Listener） <code>HttpSessionListener</code></h3><ol>
<li>定义一个类 <strong>MyServletContextListener   实现  HttpSessionListener</strong>（<code>import javax.servlet.HttpSessionListener</code>）</li>
<li>在类上添加 注解 <code>@WebListener</code></li>
<li>在启动类<strong>SpringBootApplication</strong>上添加 注解 <code>@ServletComponentScan</code> </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description:</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/8/31 16:18 by Benny</div><div class="line"> */</div><div class="line"><span class="meta">@WebListener</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHttpSessionListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Session 被创建"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"ServletContex初始化"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Spring-Boot-整合-Spring-Security"><a href="#Spring-Boot-整合-Spring-Security" class="headerlink" title="Spring Boot 整合 Spring Security"></a>Spring Boot 整合 Spring Security</h2><h3 id="添加依赖-1"><a href="#添加依赖-1" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//spring security</span></div><div class="line">compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-security'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>
<ul>
<li>主要有一下几个页面<ul>
<li>首页 所有人可访问</li>
<li>登录页 所有人可访问</li>
<li>普通页 登录后的用户都可访问</li>
<li>管理页 管理员可访问</li>
<li>无权限提醒页【当一个用户访问了其没有权限的页面，需要有一个页面来对其进行提醒】</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> <span class="keyword">extends</span> <span class="title">BaseController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INDEX_PATH = <span class="string">"/login/login"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FORBIDDEN_PATH = <span class="string">"security/forbidden"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOGOUT_PATH = <span class="string">"login/logout"</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/login"</span>,method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> INDEX_PATH;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/forbidden"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toForbiddenPage</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> FORBIDDEN_PATH;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/logout"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> LOGOUT_PATH;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>可以看到<code>/forbidden</code>（也就是当http的状态码为403的时候）实际上就是当用户访问了没有权限的页面，因此我们这里需要配置，当发现请求状态码为<code>403</code>的时候，需要交给<code>/forbidden</code>处理</p>
</blockquote>
<h3 id="根据-http-状态码处理请求"><a href="#根据-http-状态码处理请求" class="headerlink" title="根据 http 状态码处理请求"></a>根据 http 状态码处理请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.boot.context.embedded.EmbeddedServletContainerCustomizer;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ErrorPage;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description: 没有访问权限 http状态码为304的跳转处理</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/9/1 14:20 by Benny</div><div class="line"> */</div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForbiddenAccessConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * //对于Java 8来说可以用lambda表达式,而不需要创建该接口的一个实例.</div><div class="line">     */</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title">embeddedServletContainerCustomizer</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> container -&gt; container.addErrorPages(<span class="keyword">new</span> ErrorPage(HttpStatus.FORBIDDEN, <span class="string">"/forbidden"</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 此为内部类实现方式</div><div class="line">     */</div><div class="line">    <span class="comment">/*@Bean</span></div><div class="line">    public EmbeddedServletContainerCustomizer embeddedServletContainerCustomizer()&#123;</div><div class="line">        return new MyCustomizer();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static class MyCustomizer implements EmbeddedServletContainerCustomizer &#123;</div><div class="line">        @Override</div><div class="line">        public void customize(ConfigurableEmbeddedServletContainer container) &#123;</div><div class="line">            container.addErrorPages(new ErrorPage(HttpStatus.FORBIDDEN, "/forbidden"));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">*/</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
</blockquote>
<ul>
<li>这里我们利用了Spring自带的<code>EmbeddedServletContainerCustomizer</code>进行设置。当Spring发现有类型为<code>EmbeddedServletContainerCustomizer</code>注册进来，便会调用<strong>EmbeddedServletContainerCustomizer</strong> 的 <strong>customize</strong> 方法，此时，我们可以对整个Container进行设置，这里，我们添加了对于返回值为<code>HttpStatus.FORBIDDEN</code>的请求，将其交给<code>/forbidden</code>进行处理。</li>
</ul>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul>
<li>在程序启动阶段，<code>Spring Boot</code>检测到<strong>custoimer</strong>实例的存在，然后就会调用invoke(…)方法，并向内传递一个servlet对象的实例。在我们这个例子中，实际上传入的是TomcatEmbeddedServletContainerFactory容器对象，但是如果使用Jutty或者Undertow容器，就会用对应的容器对象。</li>
</ul>
<h3 id="添加spring-Security配置"><a href="#添加spring-Security配置" class="headerlink" title="添加spring Security配置"></a>添加spring Security配置</h3><h4 id="添加一个SecurityConfig类"><a href="#添加一个SecurityConfig类" class="headerlink" title="添加一个SecurityConfig类"></a>添加一个SecurityConfig类</h4><ul>
<li>我们添加一个SecurityConfig类来对Security进行配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description: Spring security 配置类</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/8/31 9:57 by Benny</div><div class="line"> */</div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function">UserDetailsService <span class="title">customerUserService</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomerUserService();</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(<span class="string">"helllo"</span>);</div><div class="line">        http</div><div class="line">                .authorizeRequests()</div><div class="line">                    .antMatchers(<span class="string">"/static/**"</span>).permitAll()</div><div class="line">                    .antMatchers(<span class="string">"/"</span>,<span class="string">"/index"</span>,<span class="string">"/login"</span>,<span class="string">"/register"</span>).permitAll()</div><div class="line">                    .antMatchers(<span class="string">"/user"</span>).hasAnyRole(<span class="string">"admin"</span>,<span class="string">"user"</span>)</div><div class="line">                    .antMatchers(<span class="string">"/user/**"</span>).hasRole(<span class="string">"admin"</span>)</div><div class="line">                    .anyRequest().authenticated()</div><div class="line">                    .and()</div><div class="line">                .formLogin()</div><div class="line">                    .loginPage(<span class="string">"/login"</span>)</div><div class="line">                    .defaultSuccessUrl(<span class="string">"/"</span>)</div><div class="line">                    .failureUrl(<span class="string">"/login?error"</span>)</div><div class="line">                    .permitAll()</div><div class="line">                .and()</div><div class="line">                    .logout()</div><div class="line">                    .logoutUrl(<span class="string">"/logout"</span>)   <span class="comment">//指定注销的URL路径</span></div><div class="line">                    .logoutSuccessUrl(<span class="string">"/"</span>)  <span class="comment">//指定注销成功后跳转的页面</span></div><div class="line">                    .permitAll();</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        auth.userDetailsService(customerUserService());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="自定义实现UserDetailsService接口"><a href="#自定义实现UserDetailsService接口" class="headerlink" title="自定义实现UserDetailsService接口"></a>自定义实现<strong>UserDetailsService</strong>接口</h4><ul>
<li>从数据库获取用户信息是必不可少的，我们有多重数据访问方式，可以是非关系型数据库，关系型数据库，常用的JPA等等。</li>
<li>使<code>AuthenticationManager</code>使用我们的<strong>CustomUserDetailsService</strong>来获取用户信息：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Description: 自定义实现数据库用户信息查询</div><div class="line"> * Created <span class="doctag">@version</span> 1.0    2016/9/1 11:10 by Benny</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomUserDetailsService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    UserService userServiceImpl;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</div><div class="line">        </div><div class="line">        User user = userServiceImpl.selectUserByName(username);</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"根据用户名没有查询到用户！"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        String roleId = user.getRoleId();</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(roleId)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"没有RoleId！"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (<span class="string">"1"</span>.equalsIgnoreCase(user.getRoleId())) &#123;</div><div class="line">            authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_admin"</span>));</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_user"</span>));</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> org.springframework.security.core.userdetails.User(user.getUserName(), user.getPassword(), authorities);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="角色权限："><a href="#角色权限：" class="headerlink" title="角色权限："></a>角色权限：</h3><ul>
<li>在自定义权限配置类中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function">UserDetailsService <span class="title">customerUserService</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomUserDetailsService();</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(<span class="string">"helllo"</span>);</div><div class="line">        http</div><div class="line">                .authorizeRequests()</div><div class="line">                    .antMatchers(<span class="string">"/user/**"</span>).hasRole(<span class="string">"ADMIN"</span>)        </div><div class="line">                    .anyRequest().authenticated();          <span class="comment">// ★★★★★hasRole()</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>查看<code>hasRole(String role)</code>方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">hasRole</span><span class="params">(String role)</span> </span>&#123;</div><div class="line">		Assert.notNull(role, <span class="string">"role cannot be null"</span>);</div><div class="line">		<span class="keyword">if</span> (role.startsWith(<span class="string">"ROLE_"</span>)) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</div><div class="line">					<span class="string">"role should not start with 'ROLE_' since it is automatically inserted. Got '"</span></div><div class="line">							+ role + <span class="string">"'"</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="string">"hasRole('ROLE_"</span> + role + <span class="string">"')"</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>总结</p>
</blockquote>
<ul>
<li>[x] 由于Spring Security 默认给我们添加了<code>ROLE_</code>,所以我们在自己的数据库中存储的最好是<code>ROLE_USER</code>,不然在Service中还要处理一下。</li>
</ul>
<h3 id="请求授权"><a href="#请求授权" class="headerlink" title="请求授权"></a>请求授权</h3><ul>
<li><p>Spring Security 是通过重写<code>protected void configure(HttpSecurity http)</code>方法来实现请求拦截的。</p>
</li>
<li><p>Spring Security 使用一下匹配器来匹配请求路径。</p>
<ul>
<li><strong>antMatchers</strong> : 使用ant风格的路径匹配</li>
<li><strong>regexMatchers</strong> : 使用正则表达式匹配路径</li>
</ul>
</li>
<li><strong>anyRequest</strong> ：匹配所有请求路径</li>
</ul>
<blockquote>
<p>匹配了请求路径后，需要针对当前用户的信息对请求路径进行安全处理，如下所示：</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>access(String)</td>
<td>Spring EL表达式结果为true时可以访问</td>
</tr>
<tr>
<td>anonymous()</td>
<td>匿名可以访问</td>
</tr>
<tr>
<td>denyAll()</td>
<td>用户不能访问</td>
</tr>
<tr>
<td>fullyAuthenticated()</td>
<td>用户完全认证可访问 【 非Remeber me 下自动登陆 】</td>
</tr>
<tr>
<td>hasAnyAuthority(String … str)</td>
<td>如果用户有参数，则其中任意权限可访问</td>
</tr>
<tr>
<td>hasAnyRole(String… Str)</td>
<td>如果用户有参数，则其中任意角色可访问</td>
</tr>
<tr>
<td>hasAuthority(String… str)</td>
<td>如果用户有参数，则其权限可访问</td>
</tr>
<tr>
<td>hasIpAddress(String)</td>
<td>如果用户来自参数中的IP可以访问</td>
</tr>
<tr>
<td>hasRole(String)</td>
<td>若用户有参数中的角色可以访问</td>
</tr>
<tr>
<td>permitAll()</td>
<td>用户可任意访问</td>
</tr>
<tr>
<td>rememberMe()</td>
<td>允许通过remember-me登陆的用户访问</td>
</tr>
<tr>
<td>authenticated()</td>
<td>用户登陆后可访问</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(<span class="string">"helllo"</span>);</div><div class="line">        http</div><div class="line">                .authorizeRequests()                                            <span class="comment">// ①</span></div><div class="line">                    .antMatchers(<span class="string">"/static/**"</span>).permitAll()                      <span class="comment">// ②设置静态资源可任意访问</span></div><div class="line">                    .antMatchers(<span class="string">"/"</span>,<span class="string">"/index"</span>,<span class="string">"/login"</span>,<span class="string">"/register"</span>).permitAll() <span class="comment">// ③设置首页登录注册页可任意访问</span></div><div class="line">                    .antMatchers(<span class="string">"/user"</span>).hasAnyRole(<span class="string">"admin"</span>,<span class="string">"user"</span>)            <span class="comment">//  角色是admin或user才可以访问</span></div><div class="line">                    .antMatchers(<span class="string">"/user/**"</span>).hasRole(<span class="string">"admin"</span>)                   <span class="comment">//  只有admin可以访问</span></div><div class="line">                    .anyRequest().authenticated()                               <span class="comment">// ④ 其余所有请求都需要认证后（登陆后）才可访问</span></div><div class="line">                    .and()</div><div class="line">                .formLogin()</div><div class="line">                    .loginPage(<span class="string">"/login"</span>)</div><div class="line">                    .defaultSuccessUrl(<span class="string">"/"</span>)</div><div class="line">                    .failureUrl(<span class="string">"/login?error"</span>)</div><div class="line">                    .permitAll()</div><div class="line">                .and()</div><div class="line">                .rememberMe()</div><div class="line">                    .tokenValiditySeconds(<span class="number">604800</span>)   <span class="comment">// 指定cookie的有效期为604800，即一个星期</span></div><div class="line">                    .key(<span class="string">"myKey"</span>)                   <span class="comment">// 指定cookie中的私钥</span></div><div class="line">                .and()</div><div class="line">                    .logout()               <span class="comment">// 使用logout方法定制注销行为</span></div><div class="line">                    .logoutUrl(<span class="string">"/logout"</span>)   <span class="comment">// logoutURL指定注销的URL路径</span></div><div class="line">                    .logoutSuccessUrl(<span class="string">"/"</span>)  <span class="comment">// logoutSuccessUrl指定注销成功后跳转的页面</span></div><div class="line">                    .permitAll();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>① 通过<code>authorizeRequests</code>方法来开始请求权限配置</li>
<li>② 请求匹配<code>/static/**</code>，可以任意访问</li>
<li>③ 请求匹配设置首页登录注册页可任意访问</li>
<li>④ 其余所有的请求都需要认证后（登陆后）才可访问</li>
</ul>
<h3 id="定制登陆行为"><a href="#定制登陆行为" class="headerlink" title="定制登陆行为"></a>定制登陆行为</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">      System.out.println(<span class="string">"helllo"</span>);</div><div class="line">      http</div><div class="line">      </div><div class="line">             ┝—————————————————————————————————————————————</div><div class="line">             ┝.authorizeRequests()</div><div class="line">             ┝    .antMatchers(<span class="string">"/static/**"</span>).permitAll()</div><div class="line">             ┝    .antMatchers(<span class="string">"/"</span>,<span class="string">"/index"</span>,<span class="string">"/login"</span>,<span class="string">"/register"</span>).permitAll()</div><div class="line">             ┝    .antMatchers(<span class="string">"/user"</span>).hasAnyRole(<span class="string">"admin"</span>,<span class="string">"user"</span>)</div><div class="line">             ┝    .antMatchers(<span class="string">"/user/**"</span>).hasRole(<span class="string">"admin"</span>)</div><div class="line">             ┝    .anyRequest().authenticated()</div><div class="line">             ┝    .and()</div><div class="line">             ┝____________________________________________  </div><div class="line">              .formLogin()                                    <span class="comment">// ① 通过formLogin()方法定制登陆操作</span></div><div class="line">                  .loginPage(<span class="string">"/login"</span>)                        <span class="comment">// 定制登陆页面访问地址</span></div><div class="line">                  .defaultSuccessUrl(<span class="string">"/"</span>)                     <span class="comment">// 指定登陆成功后转向的页面</span></div><div class="line">                  .failureUrl(<span class="string">"/login?error"</span>)                 <span class="comment">//  指定登陆失败后转向的页面</span></div><div class="line">                  .permitAll()</div><div class="line">              .and()</div><div class="line">              .rememberMe()</div><div class="line">                  .tokenValiditySeconds(<span class="number">604800</span>)               <span class="comment">// 指定cookie的有效期为604800，即一个星期</span></div><div class="line">                  .key(<span class="string">"myKey"</span>)                               <span class="comment">// 指定cookie中的私钥</span></div><div class="line">              .and()</div><div class="line">                  .logout()                                   <span class="comment">// 使用logout方法定制注销行为</span></div><div class="line">                  .logoutUrl(<span class="string">"/logout"</span>)                       <span class="comment">// logoutURL指定注销的URL路径</span></div><div class="line">                  .logoutSuccessUrl(<span class="string">"/"</span>)                      <span class="comment">// logoutSuccessUrl指定注销成功后跳转的页面</span></div><div class="line">                  .permitAll();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="Spring-boot-的支持"><a href="#Spring-boot-的支持" class="headerlink" title="Spring boot 的支持"></a>Spring boot 的支持</h2><ul>
<li>Spring Boot 针对Spring Security 的自动配置在org.spring.framework.boot.autoconfigure.security包中</li>
<li>主要通过SecurityAutoConfiguration和SecurityProperties来完成配置。</li>
<li>可以在application.yml中配置Spring Security相关的配置</li>
<li>SecurityAutoConfiguration导入了SpringBootWebSecurityConfiguration中的配置。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># Spring Security 配置：</div><div class="line"></div><div class="line">security:</div><div class="line">  user:</div><div class="line">    name: user        # 内存中的用户默认账号为user</div><div class="line">    password:         # 默认用户的密码</div><div class="line">    role: user        # 默认用户角色</div><div class="line">  require-ssl: false  # 是否需要ssl支持</div><div class="line">  enable-csrf: false  # 是否开启跨站请求伪造支持，默认关闭</div><div class="line">  basic:</div><div class="line">    enabled: true</div><div class="line">    realm: Spring</div><div class="line">    path:</div><div class="line">    authorize-mode:</div><div class="line">  filter-order: </div><div class="line">  headers:</div><div class="line">    xss: false</div><div class="line">    cache: false</div><div class="line">    frame: false</div><div class="line">    content-type: false</div><div class="line">    hsts: all</div><div class="line">  sessions: stateless</div><div class="line">  ignored:              # 用逗号分割开的无需拦截的路径</div></pre></td></tr></table></figure>
<ul>
<li>Spring boot 为我们做了如此多的配置，当我们需要自己扩展配置的时候，只需配置类 <strong>继承</strong> WebSecurityConfigurerAdapter类即可，无需使用@EnableWebSecurity注解</li>
</ul>
<h3 id="退出功能"><a href="#退出功能" class="headerlink" title="退出功能"></a>退出功能</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/logout"</span>)</div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</div><div class="line">       Authentication auth = SecurityContextHolder.getContext().getAuthentication();</div><div class="line">       <span class="keyword">if</span> (auth != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">new</span> SecurityContextLogoutHandler().logout(request, response, auth);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="string">"redirect:/login?logout"</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="消息队列-RabbitMQ"><a href="#消息队列-RabbitMQ" class="headerlink" title="消息队列 RabbitMQ"></a>消息队列 RabbitMQ</h2><h3 id="添加依赖-2"><a href="#添加依赖-2" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// RabbitMQ</span></div><div class="line">	compile group: <span class="string">'org.springframework.boot'</span>, name: <span class="string">'spring-boot-starter-amqp'</span>, version: <span class="string">'1.4.0.RELEASE'</span></div></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/08/12/160812_spring_boot/">Spring Boot</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Benny</a></p>
        <p><span>发布时间:</span>2016-08-12, 14:50:27</p>
        <p><span>最后更新:</span>2016-09-28, 14:27:08</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/08/12/160812_spring_boot/" title="Spring Boot">/2016/08/12/160812_spring_boot/</a>
            <span class="copy-path" data-clipboard-text="原文: /2016/08/12/160812_spring_boot/　　作者: Benny" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/08/15/160815_Thymeleaf/">
                    Thymeleaf模板
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/08/11/160811_beetl/">
                    好用的java模板引擎Beetl
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot"><span class="toc-number">1.</span> <span class="toc-text">Spring Boot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第一个项目"><span class="toc-number">2.</span> <span class="toc-text">第一个项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目构建"><span class="toc-number">3.</span> <span class="toc-text">项目构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目结构"><span class="toc-number">4.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot属性配置文件详解"><span class="toc-number">5.</span> <span class="toc-text">Spring Boot属性配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义属性与加载"><span class="toc-number">5.1.</span> <span class="toc-text">自定义属性与加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数间的引用"><span class="toc-number">5.2.</span> <span class="toc-text">参数间的引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用随机数"><span class="toc-number">5.3.</span> <span class="toc-text">使用随机数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过命令行设置属性值"><span class="toc-number">5.4.</span> <span class="toc-text">通过命令行设置属性值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多环境配置"><span class="toc-number">5.5.</span> <span class="toc-text">多环境配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-boot-应用的入口"><span class="toc-number">6.</span> <span class="toc-text">Spring boot 应用的入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建web项目应用模板"><span class="toc-number">7.</span> <span class="toc-text">构建web项目应用模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-boot-配置Tomcat"><span class="toc-number">8.</span> <span class="toc-text">spring boot 配置Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在application-java中配置，-配置文件配置tomcat"><span class="toc-number">8.1.</span> <span class="toc-text">在application.java中配置， 配置文件配置tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码配置tomcat"><span class="toc-number">8.2.</span> <span class="toc-text">代码配置tomcat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-boot-整合-thymeleaf-热部署"><span class="toc-number">9.</span> <span class="toc-text">spring boot 整合 thymeleaf 热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用Swagger2构建强大的RESTful-API文档"><span class="toc-number">10.</span> <span class="toc-text">使用Swagger2构建强大的RESTful API文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加文档内容"><span class="toc-number">10.1.</span> <span class="toc-text">添加文档内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot中Web应用的统一异常处理"><span class="toc-number">11.</span> <span class="toc-text">Spring Boot中Web应用的统一异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建全局异常处理类："><span class="toc-number">11.1.</span> <span class="toc-text">创建全局异常处理类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#返回JSON格式"><span class="toc-number">11.2.</span> <span class="toc-text">返回JSON格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot中使用JdbcTemplate访问数据库"><span class="toc-number">12.</span> <span class="toc-text">Spring Boot中使用JdbcTemplate访问数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据源配置"><span class="toc-number">12.1.</span> <span class="toc-text">数据源配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#嵌入式数据库支持"><span class="toc-number">12.2.</span> <span class="toc-text">嵌入式数据库支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接生产数据源"><span class="toc-number">12.3.</span> <span class="toc-text">连接生产数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用JdbcTemplate操作数据库"><span class="toc-number">12.4.</span> <span class="toc-text">使用JdbcTemplate操作数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot中使用Spring-data-jpa让数据访问更简单、更优雅"><span class="toc-number">13.</span> <span class="toc-text">Spring Boot中使用Spring-data-jpa让数据访问更简单、更优雅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot中使用Redis数据库"><span class="toc-number">14.</span> <span class="toc-text">Spring Boot中使用Redis数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#引入依赖"><span class="toc-number">14.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数配置"><span class="toc-number">14.2.</span> <span class="toc-text">参数配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot整合MyBatis"><span class="toc-number">15.</span> <span class="toc-text">Spring Boot整合MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#整合依赖"><span class="toc-number">15.1.</span> <span class="toc-text">整合依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用MyBatis"><span class="toc-number">15.2.</span> <span class="toc-text">使用MyBatis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot中使用AOP统一处理Web请求日志"><span class="toc-number">16.</span> <span class="toc-text">Spring Boot中使用AOP统一处理Web请求日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#引入依赖-1"><span class="toc-number">16.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Web层的日志切面"><span class="toc-number">16.2.</span> <span class="toc-text">实现Web层的日志切面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化：AOP切面中的同步问题"><span class="toc-number">16.3.</span> <span class="toc-text">优化：AOP切面中的同步问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化：AOP切面的优先级"><span class="toc-number">16.4.</span> <span class="toc-text">优化：AOP切面的优先级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringApplication"><span class="toc-number">17.</span> <span class="toc-text">SpringApplication</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义Banner"><span class="toc-number">17.1.</span> <span class="toc-text">自定义Banner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义SpringApplicatio"><span class="toc-number">17.2.</span> <span class="toc-text">自定义SpringApplicatio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流畅的构建API"><span class="toc-number">17.3.</span> <span class="toc-text">流畅的构建API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Application事件和监听器"><span class="toc-number">17.4.</span> <span class="toc-text">Application事件和监听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web环境"><span class="toc-number">17.5.</span> <span class="toc-text">Web环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#命令行启动器"><span class="toc-number">17.6.</span> <span class="toc-text">命令行启动器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Application退出"><span class="toc-number">17.7.</span> <span class="toc-text">Application退出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#外化配置"><span class="toc-number">18.</span> <span class="toc-text">外化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置随机值"><span class="toc-number">18.1.</span> <span class="toc-text">配置随机值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问命令行属性"><span class="toc-number">18.2.</span> <span class="toc-text">访问命令行属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Application属性文件"><span class="toc-number">19.</span> <span class="toc-text">Application属性文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#特定的Profile属性"><span class="toc-number">20.</span> <span class="toc-text">特定的Profile属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#属性占位符"><span class="toc-number">21.</span> <span class="toc-text">属性占位符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用YAML代替Properties"><span class="toc-number">21.1.</span> <span class="toc-text">使用YAML代替Properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检查应用的运行状态。"><span class="toc-number">21.2.</span> <span class="toc-text">检查应用的运行状态。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#如果希望了解的更多一些，必须要试试这个参数-debug"><span class="toc-number">21.2.1.</span> <span class="toc-text">如果希望了解的更多一些，必须要试试这个参数 --debug</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-boot-整合Redis"><span class="toc-number">22.</span> <span class="toc-text">Spring boot 整合Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#引入依赖-2"><span class="toc-number">22.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数配置-1"><span class="toc-number">22.2.</span> <span class="toc-text">参数配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试访问"><span class="toc-number">22.3.</span> <span class="toc-text">测试访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis存储对象"><span class="toc-number">22.4.</span> <span class="toc-text">Redis存储对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot-使用Redis作为缓存"><span class="toc-number">23.</span> <span class="toc-text">Spring Boot 使用Redis作为缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#引入依赖-3"><span class="toc-number">23.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数配置-2"><span class="toc-number">23.2.</span> <span class="toc-text">参数配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写RedisCacheConfig配置类："><span class="toc-number">23.3.</span> <span class="toc-text">编写RedisCacheConfig配置类：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-缓存配置"><span class="toc-number">23.3.1.</span> <span class="toc-text">Redis 缓存配置:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加注解-Cacheable-…"><span class="toc-number">23.4.</span> <span class="toc-text">添加注解@Cacheable(…)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存的生命周期"><span class="toc-number">24.</span> <span class="toc-text">缓存的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存注解-Cacheable、-CachePut、-CacheEvict"><span class="toc-number">24.1.</span> <span class="toc-text">缓存注解 @Cacheable、@CachePut、@CacheEvict</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用注解-CacheConfig"><span class="toc-number">24.2.</span> <span class="toc-text">使用注解@CacheConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义注解"><span class="toc-number">24.3.</span> <span class="toc-text">自定义注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总算明白了-Cacheable注解如何缓存"><span class="toc-number">25.</span> <span class="toc-text">总算明白了@Cacheable注解如何缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存自定义对象"><span class="toc-number">25.1.</span> <span class="toc-text">缓存自定义对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spirng-Cache-Cacheable注解的key问题"><span class="toc-number">25.2.</span> <span class="toc-text">Spirng Cache @Cacheable注解的key问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取所有定义的Bean"><span class="toc-number">26.</span> <span class="toc-text">获取所有定义的Bean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于Spring提供支持不同设备的页面"><span class="toc-number">27.</span> <span class="toc-text">基于Spring提供支持不同设备的页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加依赖"><span class="toc-number">27.1.</span> <span class="toc-text">添加依赖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建定时任务"><span class="toc-number">28.</span> <span class="toc-text">创建定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在Spring-Boot的主类中加入-EnableScheduling注解，启用定时任务的配置"><span class="toc-number">28.1.</span> <span class="toc-text">在Spring Boot的主类中加入@EnableScheduling注解，启用定时任务的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建定时任务实现类"><span class="toc-number">28.2.</span> <span class="toc-text">创建定时任务实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scheduled详解"><span class="toc-number">28.3.</span> <span class="toc-text">@Scheduled详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron-详解"><span class="toc-number">28.4.</span> <span class="toc-text">cron 详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Spring-Security的配置类WebSecurityConfig"><span class="toc-number">28.5.</span> <span class="toc-text">创建Spring Security的配置类WebSecurityConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指定登录页地址"><span class="toc-number">28.6.</span> <span class="toc-text">指定登录页地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-boot-过滤器-拦截器"><span class="toc-number">29.</span> <span class="toc-text">Spring boot 过滤器 拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义过滤器类"><span class="toc-number">29.1.</span> <span class="toc-text">自定义过滤器类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ServletContext监听器（Listener）ServletContextListener"><span class="toc-number">29.2.</span> <span class="toc-text">ServletContext监听器（Listener）ServletContextListener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ServletContext监听器（Listener）-HttpSessionListener"><span class="toc-number">29.3.</span> <span class="toc-text">ServletContext监听器（Listener） HttpSessionListener</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot-整合-Spring-Security"><span class="toc-number">30.</span> <span class="toc-text">Spring Boot 整合 Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加依赖-1"><span class="toc-number">30.1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#根据-http-状态码处理请求"><span class="toc-number">30.2.</span> <span class="toc-text">根据 http 状态码处理请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分析"><span class="toc-number">30.2.1.</span> <span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加spring-Security配置"><span class="toc-number">30.3.</span> <span class="toc-text">添加spring Security配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#添加一个SecurityConfig类"><span class="toc-number">30.3.1.</span> <span class="toc-text">添加一个SecurityConfig类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义实现UserDetailsService接口"><span class="toc-number">30.3.2.</span> <span class="toc-text">自定义实现UserDetailsService接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#角色权限："><span class="toc-number">30.4.</span> <span class="toc-text">角色权限：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求授权"><span class="toc-number">30.5.</span> <span class="toc-text">请求授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定制登陆行为"><span class="toc-number">30.6.</span> <span class="toc-text">定制登陆行为</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-boot-的支持"><span class="toc-number">31.</span> <span class="toc-text">Spring boot 的支持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#退出功能"><span class="toc-number">31.1.</span> <span class="toc-text">退出功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息队列-RabbitMQ"><span class="toc-number">32.</span> <span class="toc-text">消息队列 RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加依赖-2"><span class="toc-number">32.1.</span> <span class="toc-text">添加依赖</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Spring Boot　| Benny　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section class="youyan" id="comments">
    <script>
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = 'http://v2.uyan.cc/code/uyan.js?uid=2105061';
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

    <div id="uyan_frame"></div>
</section>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/08/15/160815_Thymeleaf/" title="上一篇: Thymeleaf模板">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/08/11/160811_beetl/" title="下一篇: 好用的java模板引擎Beetl">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/18/160918_singleton/">关于单例的那点事</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/17/160917_effective_java/">Effective Java 第二版</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/07/160805_lambda/">java8</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/18/160818_junit_spirng_mock/">基于Spring web 做单元测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/17/160817_yaml/">YAML</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/160815_Thymeleaf/">Thymeleaf模板</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/12/160812_spring_boot/">Spring Boot</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/160811_beetl/">好用的java模板引擎Beetl</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/10/160810_guava_read/">使用Guava来编写优雅的代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/08/160808_idea_shortcutKeys/">Intellij idea的快捷键</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/06/160806_vim/">vim</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/04/160804_sc_spring/">【源码阅读】Spring源码阅读</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/03/160803_analyze_javaweb/">深入分析Java Web</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/02/160802_designpatern_read/">设计模式之禅</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/160801_sc_arraylist/">ArrayList源码阅读</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/25/160725_rsa_algorithm/">RSA加密签名</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/06/160706_linuxcommand/">关于Linux命令的那点小事</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/05/160705_plantuml/">plantUML的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/03/160703_linuxShellLine/">Linux Shell 命令行及脚本编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/02/160706_clean_code/">代码整洁之道</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/160630_jqueryplugin/">jQuery plugin 插件编写时遇到的问题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/28/160628_first/">博客初搭建</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 Benny
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>